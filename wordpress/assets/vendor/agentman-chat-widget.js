!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("ChatWidget",[],e):"object"==typeof exports?exports.ChatWidget=e():t.ChatWidget=e()}("undefined"!=typeof self?self:this,(()=>(()=>{"use strict";var t={144:(t,e,n)=>{n.d(e,{W:()=>a,e:()=>o});var a='\n  /* File attachment button */\n  .chat-attachment-button {\n    background: none;\n    border: none;\n    cursor: pointer;\n    padding: 8px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: var(--chat-text-color);\n    opacity: 0.7;\n    transition: opacity 0.2s;\n  }\n\n  .chat-attachment-button:hover {\n    opacity: 1;\n  }\n\n  .chat-attachment-button svg {\n    width: 20px;\n    height: 20px;\n  }\n\n  /* Hidden file input */\n  .chat-file-input {\n    display: none;\n  }\n\n  /* Attachment preview container - STACKED: Full width row above input */\n  .chat-attachments-preview {\n    display: flex;\n    flex-direction: row;\n    gap: 8px;\n    padding: 12px 16px;\n    overflow-x: auto;\n    overflow-y: hidden;\n    position: relative;\n    width: 100%;\n    background: rgba(0, 0, 0, 0.02);\n    border-bottom: none;\n    \n    /* Custom scrollbar */\n    scrollbar-width: thin;\n    scrollbar-color: rgba(0, 0, 0, 0.2) transparent;\n  }\n\n  .chat-attachments-preview::-webkit-scrollbar {\n    height: 4px;\n  }\n\n  .chat-attachments-preview::-webkit-scrollbar-track {\n    background: transparent;\n  }\n\n  .chat-attachments-preview::-webkit-scrollbar-thumb {\n    background: rgba(0, 0, 0, 0.2);\n    border-radius: 2px;\n  }\n\n  .chat-attachments-preview::-webkit-scrollbar-thumb:hover {\n    background: rgba(0, 0, 0, 0.3);\n  }\n\n  /* Scroll hint indicator */\n  .chat-attachments-preview::after {\n    content: \'\';\n    position: absolute;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    width: 20px;\n    background: linear-gradient(to left, rgba(0, 0, 0, 0.02), transparent);\n    pointer-events: none;\n    opacity: 0;\n    transition: opacity 0.3s;\n  }\n\n  .chat-attachments-preview.has-overflow::after {\n    opacity: 1;\n  }\n\n  /* Individual attachment item - MINIMAL: Clean thumbnail design */\n  .chat-attachment-item {\n    position: relative;\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    background: rgba(255, 255, 255, 0.8);\n    border: 1px solid rgba(0, 0, 0, 0.1);\n    border-radius: 8px;\n    padding: 8px;\n    animation: slideIn 0.2s ease-out;\n    width: 40%;\n    flex-shrink: 0;\n    cursor: default;\n    transition: all 0.2s;\n    gap: 10px;\n    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);\n  }\n\n  .chat-attachment-item:hover {\n    background: rgba(255, 255, 255, 0.95);\n    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);\n  }\n\n  @keyframes slideIn {\n    from {\n      opacity: 0;\n      transform: translateY(-10px);\n    }\n    to {\n      opacity: 1;\n      transform: translateY(0);\n    }\n  }\n\n  /* Attachment thumbnail for images - MINIMAL: Larger preview */\n  .chat-attachment-thumbnail {\n    width: 40px;\n    height: 40px;\n    object-fit: cover;\n    border-radius: 6px;\n    flex-shrink: 0;\n  }\n\n  /* File icon for non-images - MINIMAL: Larger icon area */\n  .chat-attachment-icon {\n    width: 40px;\n    height: 40px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background: rgba(59, 130, 246, 0.08);\n    border-radius: 6px;\n    flex-shrink: 0;\n  }\n\n  .chat-attachment-icon svg {\n    width: 20px;\n    height: 20px;\n    opacity: 0.6;\n    color: rgba(59, 130, 246, 0.7);\n  }\n\n  /* Attachment info - HORIZONTAL: Left-aligned for inline layout */\n  .chat-attachment-info {\n    flex: 1;\n    min-width: 0;\n  }\n\n  .chat-attachment-name {\n    font-size: 13px;\n    font-weight: 400;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    line-height: 1.3;\n    color: rgba(0, 0, 0, 0.7);\n  }\n\n  /* Remove button - MINIMAL: Subtle √ó in top-right corner */\n  .chat-attachment-remove {\n    position: absolute;\n    top: 4px;\n    right: 4px;\n    width: 18px;\n    height: 18px;\n    background: rgba(0, 0, 0, 0.05);\n    color: rgba(0, 0, 0, 0.4);\n    border: none;\n    border-radius: 50%;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 14px;\n    font-weight: normal;\n    line-height: 1;\n    transition: all 0.2s;\n    padding: 0;\n  }\n\n  .chat-attachment-remove:hover {\n    background: rgba(0, 0, 0, 0.1);\n    color: rgba(0, 0, 0, 0.6);\n  }\n\n  .chat-attachment-remove:active {\n    transform: scale(0.9);\n  }\n\n  /* Upload progress - HORIZONTAL: Bottom overlay for inline layout */\n  .chat-attachment-progress {\n    position: absolute;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    height: 2px;\n    background: rgba(0, 0, 0, 0.1);\n    border-radius: 0 0 6px 6px;\n    overflow: hidden;\n  }\n\n  .chat-attachment-progress-bar {\n    height: 100%;\n    background: linear-gradient(90deg, #3b82f6, #2563eb);\n    transition: width 0.3s ease;\n    border-radius: 2px;\n    position: relative;\n  }\n\n  .chat-attachment-progress-bar::after {\n    content: \'\';\n    position: absolute;\n    top: 0;\n    left: 0;\n    bottom: 0;\n    right: 0;\n    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);\n    animation: shimmer 1.5s infinite;\n  }\n\n  @keyframes shimmer {\n    0% { transform: translateX(-100%); }\n    100% { transform: translateX(100%); }\n  }\n\n  /* Error state */\n  .chat-attachment-item.error {\n    background: rgba(255, 0, 0, 0.1);\n  }\n\n  .chat-attachment-item.error .chat-attachment-name {\n    color: #ff0000;\n  }\n\n  /* Attachments in messages */\n  .chat-message-attachments {\n    margin-top: 8px;\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n  }\n\n  .chat-message-attachment {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    background: rgba(0, 0, 0, 0.03);\n    border: 1px solid rgba(0, 0, 0, 0.1);\n    border-radius: 6px;\n    padding: 6px 8px;\n    text-decoration: none;\n    color: inherit;\n    transition: background 0.2s;\n  }\n\n  .chat-message-attachment:hover {\n    background: rgba(0, 0, 0, 0.05);\n    text-decoration: none;\n  }\n\n  .message-attachment-icon {\n    width: 16px;\n    height: 16px;\n    margin-right: 6px;\n    opacity: 0.6;\n  }\n\n  .message-attachment-image {\n    max-width: 200px;\n    max-height: 200px;\n    border-radius: 8px;\n    cursor: pointer;\n    transition: transform 0.2s;\n  }\n\n  .message-attachment-image:hover {\n    transform: scale(1.05);\n  }\n\n  /* File type icons */\n  .icon-file-document::before {\n    content: "üìÑ";\n    font-size: 20px;\n  }\n\n  .icon-file-image::before {\n    content: "üñºÔ∏è";\n    font-size: 20px;\n  }\n\n  .icon-file-audio::before {\n    content: "üéµ";\n    font-size: 20px;\n  }\n\n  .icon-file-video::before {\n    content: "üé¨";\n    font-size: 20px;\n  }\n\n  .icon-file-data::before {\n    content: "üìä";\n    font-size: 20px;\n  }\n\n  .icon-file-text::before {\n    content: "üìù";\n    font-size: 20px;\n  }\n\n  /* Responsive adjustments - HORIZONTAL: Better mobile experience */\n  @media (max-width: 480px) {\n    .chat-attachments-preview {\n      padding: 6px 0;\n      gap: 6px;\n    }\n\n    .chat-attachment-item {\n      width: 45%;\n      padding: 4px 6px;\n      gap: 6px;\n    }\n\n    .chat-attachment-thumbnail,\n    .chat-attachment-icon {\n      width: 36px;\n      height: 36px;\n    }\n\n    .chat-attachment-icon svg {\n      width: 18px;\n      height: 18px;\n    }\n\n    .chat-attachment-name {\n      font-size: 12px;\n    }\n\n    .chat-attachment-remove {\n      width: 16px;\n      height: 16px;\n      top: 2px;\n      right: 2px;\n      font-size: 12px;\n    }\n  }\n\n  /* Extra improvements for very wide screens */\n  @media (min-width: 768px) {\n    .chat-attachment-item {\n      padding: 10px;\n    }\n\n    .chat-attachment-thumbnail,\n    .chat-attachment-icon {\n      width: 44px;\n      height: 44px;\n    }\n\n    .chat-attachment-name {\n      font-size: 13px;\n    }\n  }\n',o={paperclip:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n    <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path>\n  </svg>',document:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>\n    <polyline points="14 2 14 8 20 8"></polyline>\n    <line x1="16" y1="13" x2="8" y2="13"></line>\n    <line x1="16" y1="17" x2="8" y2="17"></line>\n    <polyline points="10 9 9 9 8 9"></polyline>\n  </svg>',image:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>\n    <circle cx="8.5" cy="8.5" r="1.5"></circle>\n    <polyline points="21 15 16 10 5 21"></polyline>\n  </svg>',audio:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n    <path d="M9 18V5l12-2v13"></path>\n    <circle cx="6" cy="18" r="3"></circle>\n    <circle cx="18" cy="16" r="3"></circle>\n  </svg>',video:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n    <polygon points="23 7 16 12 23 17 23 7"></polygon>\n    <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>\n  </svg>',file:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n    <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path>\n    <polyline points="13 2 13 9 20 9"></polyline>\n  </svg>',close:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n    <line x1="18" y1="6" x2="6" y2="18"></line>\n    <line x1="6" y1="6" x2="18" y2="18"></line>\n  </svg>'}}},e={};function n(a){var o=e[a];if(void 0!==o)return o.exports;var i=e[a]={exports:{}};return t[a](i,i.exports,n),i.exports}n.d=(t,e)=>{for(var a in e)n.o(e,a)&&!n.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var a={};n.d(a,{ChatWidget:()=>G});const o={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let i;const r=new Uint8Array(16),s=[];for(let t=0;t<256;++t)s.push((t+256).toString(16).slice(1));const c=function(t,e,n){if(o.randomUUID&&!e&&!t)return o.randomUUID();const a=(t=t||{}).random??t.rng?.()??function(){if(!i){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");i=crypto.getRandomValues.bind(crypto)}return i(r)}();if(a.length<16)throw new Error("Random bytes length must be >= 16");if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,e){if((n=n||0)<0||n+16>e.length)throw new RangeError(`UUID byte range ${n}:${n+15} is out of buffer bounds`);for(let t=0;t<16;++t)e[n+t]=a[t];return e}return function(t,e=0){return(s[t[e+0]]+s[t[e+1]]+s[t[e+2]]+s[t[e+3]]+"-"+s[t[e+4]]+s[t[e+5]]+"-"+s[t[e+6]]+s[t[e+7]]+"-"+s[t[e+8]]+s[t[e+9]]+"-"+s[t[e+10]]+s[t[e+11]]+s[t[e+12]]+s[t[e+13]]+s[t[e+14]]+s[t[e+15]]).toLowerCase()}(a)};var l=function(){function t(t,e,n){void 0===n&&(n=!0);var a=this;this.containerId=t,this.stateManager=e,this.enabled=n,this.convKey=function(t){return"chatwidget_".concat(a.containerId,"_conv_").concat(t)}}return Object.defineProperty(t.prototype,"indexKey",{get:function(){return"chatwidget_".concat(this.containerId,"_index")},enumerable:!1,configurable:!0}),t.prototype.readIndex=function(){var t=localStorage.getItem(this.indexKey);return t?JSON.parse(t):{version:2,conversations:[]}},t.prototype.writeIndex=function(t){localStorage.setItem(this.indexKey,JSON.stringify(t))},t.prototype.list=function(){return this.readIndex().conversations.sort((function(t,e){return e.lastUpdated-t.lastUpdated}))},t.prototype.getCurrentId=function(){return this.readIndex().currentId},t.prototype.create=function(t){void 0===t&&(t="New chat");var e=c(),n={id:e,title:t,lastUpdated:Date.now()},a=this.readIndex();a.conversations.unshift(n),a.currentId=e,this.writeIndex(a);var o={version:2,messages:[],timestamp:Date.now()};return localStorage.setItem(this.convKey(e),JSON.stringify(o)),e},t.prototype.switchTo=function(t){console.log("üîÑ switchTo(".concat(t,") called"));var e=this.readIndex();if(!e.conversations.find((function(e){return e.id===t})))throw console.log("‚ùå switchTo() failed - unknown conversation id: ".concat(t)),new Error("unknown conversation id");e.currentId=t,console.log("‚úÖ switchTo() - setting currentId to ".concat(t)),this.writeIndex(e)},t.prototype.delete=function(t){var e;localStorage.removeItem(this.convKey(t));var n=this.readIndex();n.conversations=n.conversations.filter((function(e){return e.id!==t})),n.currentId===t&&(n.currentId=null===(e=n.conversations[0])||void 0===e?void 0:e.id),this.writeIndex(n)},t.prototype.loadMessages=function(){var t=this.getCurrentId();if(!t)return[];try{var e=localStorage.getItem(this.convKey(t));if(!e)return[];var n=this.parseAndValidatePayload(e);return(null==n?void 0:n.messages)||[]}catch(t){return console.error("Failed to load messages:",t),[]}},t.prototype.loadMetadata=function(){var t=this.getCurrentId();if(!t)return null;try{var e=localStorage.getItem(this.convKey(t));if(!e)return null;var n=this.parseAndValidatePayload(e);return(null==n?void 0:n.metadata)||null}catch(t){return console.error("Failed to load metadata:",t),null}},t.prototype.saveMetadata=function(t){if(console.log("üíæ saveMetadata() called",t),this.enabled){var e=this.getCurrentId();if(e)try{this.saveMetadataAtomic(e,t)}catch(t){console.error("Failed to save metadata:",t)}else console.log("‚è≠Ô∏è saveMetadata() aborted - no current conversation ID")}else console.log("‚è≠Ô∏è saveMetadata() aborted - persistence not enabled")},t.prototype.saveMetadataAtomic=function(t,e){var n,a=this.convKey(t),o=localStorage.getItem(a);o?n=this.parseAndValidatePayload(o)||this.createDefaultPayload():(n=this.createDefaultPayload()).messages=this.stateManager.getState().messages,n.metadata=e,n.timestamp=Date.now();var i=JSON.stringify(n);localStorage.setItem(a,i),this.updateIndexMetadata(t,e),console.log("‚úÖ Metadata saved atomically")},t.prototype.updateIndexMetadata=function(t,e){try{var n=this.readIndex(),a=n.conversations.find((function(e){return e.id===t}));a&&(a.metadata=e,this.writeIndex(n))}catch(t){console.error("Failed to update index metadata:",t)}},t.prototype.saveMessages=function(){if(console.log("üìù saveMessages() called"),this.enabled){var t=this.getCurrentId();if(t){var e=this.stateManager.getState().messages;console.log("üìä Current messages count: ".concat(e.length));var n=this.convKey(t),a=localStorage.getItem(n),o=a?JSON.parse(a).messages:[];if(console.log("üìä Existing messages count: ".concat(o.length)),o.length===e.length&&o.length>0)console.log("‚è≠Ô∏è saveMessages() aborted - no changes detected");else{var i;if(console.log("üíæ Saving messages - changes detected"),a)try{var r=this.parseAndValidatePayload(a);i=null==r?void 0:r.metadata}catch(t){console.warn("Failed to parse existing metadata, continuing without it:",t)}var s={version:2,messages:e,timestamp:Date.now(),metadata:i};try{localStorage.setItem(n,JSON.stringify(s))}catch(t){throw console.error("Failed to save messages:",t),t}var c=this.readIndex(),l=c.conversations.find((function(e){return e.id===t}));if(l){l.lastUpdated=s.timestamp;var d=e.find((function(t){return"user"===t.sender}));if(d){var h=d.content.trim();l.title=h.length>25?h.slice(0,25)+"...":h}else"New chat"===l.title&&e.length>0&&(l.title="Chat with Agentman");this.writeIndex(c)}}}else console.log("‚è≠Ô∏è saveMessages() aborted - no current conversation ID")}else console.log("‚è≠Ô∏è saveMessages() aborted - persistence not enabled")},t.prototype.migrateLegacy=function(){var t="chatwidget_".concat(this.containerId,"_data"),e=localStorage.getItem(t);if(e)try{var n=JSON.parse(e).messages,a=this.create("Imported chat");localStorage.setItem(this.convKey(a),JSON.stringify({version:2,messages:n,timestamp:Date.now()})),localStorage.removeItem(t)}catch(t){console.error("Error migrating legacy data:",t)}},t.prototype.setConversationId=function(t){this.switchTo(t)},t.prototype.getConversationId=function(){return this.getCurrentId()||null},t.prototype.clearStorage=function(){var t=this.getCurrentId();t&&this.delete(t)},t.prototype.parseAndValidatePayload=function(t){try{var e=JSON.parse(t);if("object"!=typeof e||null===e)throw new Error("Invalid payload format");if("number"!=typeof e.version||2!==e.version)throw new Error("Invalid or unsupported payload version");if(!Array.isArray(e.messages))throw new Error("Invalid messages format");if("number"!=typeof e.timestamp)throw new Error("Invalid timestamp format");return e}catch(t){return console.warn("Failed to parse conversation payload:",t),null}},t.prototype.createDefaultPayload=function(){return{version:2,messages:[],timestamp:Date.now()}},t}(),d=function(){return d=Object.assign||function(t){for(var e,n=1,a=arguments.length;n<a;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},d.apply(this,arguments)},h=function(t,e,n,a){return new(n||(n=Promise))((function(o,i){function r(t){try{c(a.next(t))}catch(t){i(t)}}function s(t){try{c(a.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,s)}c((a=a.apply(t,e||[])).next())}))},p=function(t,e){var n,a,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},r=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return r.next=s(0),r.throw=s(1),r.return=s(2),"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,s[0]&&(i=0)),i;)try{if(n=1,a&&(o=2&s[0]?a.return:s[0]?a.throw||((o=a.return)&&o.call(a),0):a.next)&&!(o=o.call(a,s[1])).done)return o;switch(a=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,a=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=e.call(t,i)}catch(t){s=[6,t],a=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},m=function(){function t(t,e,n){this.apiUrl=t,this.agentToken=e,this.conversationId=n}return t.prototype.uploadFile=function(t,e){return h(this,void 0,void 0,(function(){var n=this;return p(this,(function(a){return[2,new Promise((function(a,o){var i=new XMLHttpRequest,r=new FormData;r.append("file",t);var s={file_id:"temp_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),filename:t.name,content_type:t.type||"application/octet-stream",file_type:n.getFileType(t),size_bytes:t.size,upload_status:"pending",upload_progress:0};i.upload.addEventListener("progress",(function(t){if(t.lengthComputable){var n=Math.round(t.loaded/t.total*100);e&&e(n)}})),i.addEventListener("load",(function(){if(i.status>=200&&i.status<300)try{var t=JSON.parse(i.responseText),e=d(d({},s),{file_id:t.file_id,url:t.url,created_at:t.created_at,expires_at:t.expires_at,upload_status:"success",upload_progress:100});a(e)}catch(t){o(new Error("Failed to parse upload response"))}else{var n="Upload failed",r="";try{var c=JSON.parse(i.responseText);console.error("Upload error response:",c),422===i.status&&c.detail?(r=Array.isArray(c.detail)?c.detail.map((function(t){var e;return"".concat(null===(e=t.loc)||void 0===e?void 0:e.join(".")," - ").concat(t.msg)})).join(", "):c.detail,n="Validation error: ".concat(r)):n=c.error||c.message||n}catch(t){console.error("Failed to parse error response:",i.responseText),n="".concat(n," - ").concat(i.responseText)}o(new Error("".concat(n," (Status: ").concat(i.status,")")))}})),i.addEventListener("error",(function(){o(new Error("Network error during upload"))})),i.addEventListener("abort",(function(){o(new Error("Upload cancelled"))}));var c=new URL("".concat(n.apiUrl,"/v2/agentman_runtime/files/upload"));n.conversationId&&c.searchParams.append("conversation_id",n.conversationId),i.open("POST",c.toString()),i.setRequestHeader("agent_token",n.agentToken),i.send(r)}))]}))}))},t.prototype.deleteFile=function(t){return h(this,void 0,void 0,(function(){var e;return p(this,(function(n){switch(n.label){case 0:return[4,fetch("".concat(this.apiUrl,"/v2/agentman_runtime/files/").concat(t),{method:"DELETE",headers:{agent_token:this.agentToken}})];case 1:if(!(e=n.sent()).ok)throw new Error("Failed to delete file: ".concat(e.statusText));return[2]}}))}))},t.prototype.getFileType=function(t){var e=t.type.toLowerCase();return e.startsWith("image/")?"image":e.startsWith("audio/")?"audio":e.startsWith("video/")?"video":e.startsWith("text/")||"application/json"===e||"application/xml"===e?"text":"application/pdf"===e||"application/msword"===e||e.includes("document")||e.includes("spreadsheet")||e.includes("presentation")?"document":"data"},t.prototype.validateFile=function(t){return t.size>104857600?"File size exceeds maximum allowed size of 100MB":null},t.formatFileSize=function(t){if(0===t)return"0 Bytes";var e=Math.floor(Math.log(t)/Math.log(1024));return parseFloat((t/Math.pow(1024,e)).toFixed(2))+" "+["Bytes","KB","MB","GB"][e]},t}(),g='\n<svg id="eGF4vShlzWg1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 482 463" shape-rendering="geometricPrecision" text-rendering="geometricPrecision" project-id="b6a2902621314759b6f55f35963e502f" export-id="3ac2b3de3acd4688a4d0e052043a141a" cached="false">\n  <style>\n    .main-color {\n      fill: var(--chat-toggle-icon-color, --chat-header-text-color, #10b981);\n    }\n  </style>\n  <ellipse rx="195.69139" ry="195.69139" transform="matrix(1.029699 0 0 1.029699 240.53478 231.5)" class="main-color" stroke-width="0"/>\n  <path d="M115.170448,367.37098l75.209552-41.95l34.570045,89.914073q-71.559193-7.964036-109.779597-47.964073Z" transform="translate(1.705203 0.000002)" fill="#fff" stroke="#fff" stroke-width="0.964"/>\n  <path d="M115.170448,367.37098l75.209552-41.95l34.570045,89.914073q-71.559193-7.964036-109.779597-47.964073Z" transform="matrix(-1 0 0 1 477.488884 0.213954)" fill="#fff" stroke="#fff" stroke-width="0.964"/>\n  <path d="" fill="none" stroke="#3f5787" stroke-width="0.964"/>\n  <path d="M239.689307,333.842501l-11.989999,12.523368l7.640737,9.115074-9.00527,28.429999l13.354532,21.66l12.169999-21.66-8.276464-28.429999l7.683584-9.115074-11.577119-12.523368Z" transform="translate(.000003-8.207567)" fill="#fff" stroke-width="0.964"/>\n  <path d="M277.027489,313.607575c2.10968-2.124145,2.109674-7.294472,2.10968-12.616701.000001-4.924048,3.734359-8.575732,5.993261-11.785502c6.850428-9.734066,17.425154-17.270326,32.509567-28.554392c19.581659-14.648281,38.363352-37.839451,38.363352-75.004322s-15.358165-77.557662-47.326267-97.060908-100.336835-21.863731-138.616835,11.230119q-38.28,33.09385-26.47094,84.615075q2.941471,5.424961-4.109265,16.914925c-7.050736,11.489964-5.790737,10.87-13.400737,20.07q-7.61,9.2,14.77,24.588001q8.081429,8.196065,4.040692,25.931176c-4.040737,17.735111,17.930782,25.351045,58.470045,26.015934c6.315019,0,10.285402,4.016302,9.820182,13.53245c2.318232,3.860567,45.195831,4.173208,63.847265,2.124145Z" transform="translate(-4.731067 2.174968)" fill="#fff" stroke-width="0.964"/>\n  <g transform="translate(-1.999999 1)">\n    <path d="M245.9733,169.12822c0-15.53699,12.59522-28.13221,28.13221-28.13221s28.13221,12.59522,28.13221,28.13221-12.59522,28.13221-28.13221,28.13221-28.13221-12.59522-28.13221-28.13221Zm28.13221,16.48705c9.10555,0,16.48705-7.3815,16.48705-16.48705s-7.3815-16.48705-16.48705-16.48705-16.48705,7.3815-16.48705,16.48705s7.3815,16.48705,16.48705,16.48705Z" transform="matrix(.869702 0 0 0.869702 29.215138 13.949797)" class="main-color" stroke-width="0"/>\n    <ellipse rx="12.075348" ry="12.075348" transform="translate(205.701579 163.375556)" class="main-color" stroke-width="0"/>\n    <path d="M181.65805,163.37556c0-13.2238,10.72001-23.94381,23.94382-23.94381c3.66235,0,7.13266.82225,10.23639,2.29221l-1.90827,3.5391c-2.53417-1.16714-5.35513-1.81808-8.32812-1.81808-11.00735,0-19.93057,8.92323-19.93057,19.93059s8.92322,19.93059,19.93057,19.93059c2.7639,0,5.3964-.5626,7.78923-1.57954l2.86146,3.09941c-3.20793,1.59589-6.8245,2.49335-10.65068,2.49335-13.22381,0-23.94382-10.72001-23.94382-23.94381l-.00001-.00001Z" transform="translate(-.294799 0)" class="main-color" stroke-width="0"/>\n    <path d="M282.21447,221.07121c10.36489,0,18.76729,8.40244,18.76729,18.76737s-8.4024,18.76737-18.76729,18.76737c-2.06817,0-4.05821-.33454-5.91895-.95246l.40538-3.19396c1.7145.64687,3.5727,1.00082,5.51357,1.00082c8.62762,0,15.62168-6.99411,15.62168-15.62178s-6.99406-15.62178-15.62168-15.62178c-.56983,0-1.13253.03051-1.68657.08999l.4052-3.19253c.42343-.02855.85071-.04306,1.28137-.04306v.00002Z" transform="translate(-.294799 0.000001)" class="main-color" stroke-width="0"/>\n    <ellipse rx="12.075348" ry="12.075348" transform="matrix(.818722 0 0 0.818719 201.720047 112.620951)" class="main-color" stroke-width="0"/>\n    <ellipse rx="12.075348" ry="12.075348" transform="matrix(.818722 0 0 0.818719 232.659876 121.50729)" class="main-color" stroke-width="0"/>\n    <ellipse rx="12.382248" ry="12.382248" transform="matrix(.910778 0 0 0.950271 282.214464 239.661329)" class="main-color" stroke-width="0"/>\n    <ellipse rx="14.374568" ry="14.374568" transform="translate(289.307806 110.097611)" class="main-color" stroke-width="0"/>\n    <ellipse rx="13.63993" ry="13.63993" transform="translate(323.793572 185.845218)" class="main-color" stroke-width="0"/>\n    <ellipse rx="14.309665" ry="14.309665" transform="matrix(.771673 0 0 0.771673 240.96831 199.507461)" fill="#d2dbed" stroke-width="0"/>\n    <ellipse rx="14.309665" ry="14.309665" transform="matrix(.771673 0 0 0.771673 240.96831 199.507461)" class="main-color" stroke-width="0"/>\n    <rect width="7.630899" height="118.396225" rx="0" ry="0" transform="matrix(1 0 0 0.934365 258.59969 181.205336)" class="main-color" stroke-width="0"/>\n    <rect width="7.630899" height="118.396225" rx="0" ry="0" transform="matrix(1 0 0 0.514936 278.399015 177.174522)" class="main-color" stroke-width="0"/>\n    <rect width="7.630899" height="118.396225" rx="0" ry="0" transform="matrix(1 0 0 0.386956 319.978123 142.907789)" class="main-color" stroke-width="0"/>\n    <rect width="7.630899" height="118.396225" rx="0" ry="0" transform="matrix(1 0 0 0.231676 198.393736 116.13011)" class="main-color" stroke-width="0"/>\n    <rect width="7.630899" height="118.396225" rx="0" ry="0" transform="matrix(-.707107 0.707107-.295051-.295051 243.232709 195.973864)" class="main-color" stroke-width="0"/>\n    <rect width="7.630899" height="118.396225" rx="0" ry="0" transform="matrix(-.707107 0.707107-.186101-.186101 259.29762 141.857073)" class="main-color" stroke-width="0"/>\n    <rect width="7.630899" height="118.396225" rx="0" ry="0" transform="matrix(-.938368-.345637 0.090967-.246966 281.751813 143.498375)" class="main-color" stroke-width="0"/>\n    <rect width="7.630899" height="118.396225" rx="0" ry="0" transform="matrix(0 0.999992-.386956 0 249.980637 159.560138)" class="main-color" stroke-width="0"/>\n    <rect width="7.630899" height="118.396225" rx="0" ry="0" transform="matrix(0 0.999992-.319024 0 325.523655 159.560138)" fill="#d2dbed" stroke-width="0"/>\n    <rect width="7.630899" height="118.396225" rx="0" ry="0" transform="matrix(0 0.999992-.319024 0 325.523655 159.560138)" class="main-color" stroke-width="0"/>\n  </g>\n</svg>\n',u=function(){return u=Object.assign||function(t){for(var e,n=1,a=arguments.length;n<a;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},u.apply(this,arguments)},f=function(){function t(t){this.validateConfig(t),this.config=this.mergeWithDefaults(t),this.theme=this.initializeTheme(),this.assets=this.initializeAssets(),this.icons=this.initializeIcons()}return t.prototype.validateConfig=function(t){if(!t.apiUrl)throw new Error("API URL is required");if(!t.agentToken)throw new Error("Agent token is required")},t.prototype.mergeWithDefaults=function(e){return u(u({},e),{title:e.title||"Chat Assistant",position:e.position||"bottom-right",hideBranding:void 0===e.hideBranding||e.hideBranding,theme:u(u({},t.defaultTheme),e.theme)})},t.prototype.initializeTheme=function(){return u(u({},t.defaultTheme),this.config.theme)},t.prototype.initializeAssets=function(){return{logo:this.config.logo||t.defaultAssets.logo,headerLogo:this.config.headerLogo||t.defaultAssets.headerLogo}},t.prototype.initializeIcons=function(){var e=/^(data:image\/|https:\/\/|\/)/i,n={closeIcon:t.defaultIcons.closeIcon,sendIcon:t.defaultIcons.sendIcon,minimizeIcon:t.defaultIcons.minimizeIcon,maximizeIcon:t.defaultIcons.maximizeIcon,expandIcon:t.defaultIcons.expandIcon,reduceIcon:t.defaultIcons.reduceIcon};return this.config.icons&&Object.entries(this.config.icons).forEach((function(t){var a=t[0],o=t[1];o&&e.test(o)&&(n[a]=o)})),n},t.prototype.getConfig=function(){return this.config},t.prototype.getTheme=function(){return this.theme},t.prototype.getAssets=function(){return this.assets},t.prototype.getIcons=function(){return this.icons},t.prototype.getCSSVariables=function(){return{"--chat-text-color":this.theme.textColor,"--chat-background-color":this.theme.backgroundColor,"--chat-button-color":this.theme.buttonColor,"--chat-button-text-color":this.theme.buttonTextColor,"--chat-agent-foreground-color":this.theme.agentForegroundColor,"--chat-user-foreground-color":this.theme.userForegroundColor,"--chat-toggle-background-color":this.theme.toggleBackgroundColor,"--chat-toggle-text-color":this.theme.toggleTextColor,"--chat-toggle-icon-color":this.theme.toggleIconColor}},t.prototype.updateTheme=function(t){this.theme=u(u({},this.theme),t)},t.prototype.updateAssets=function(t){this.assets=this.initializeAssets()},t.prototype.updateIcons=function(t){this.icons=this.initializeIcons()},t.defaultTheme={textColor:"#111827",backgroundColor:"#ffffff",buttonColor:"#2563eb",buttonTextColor:"#ffffff",agentForegroundColor:"#111827",userForegroundColor:"#2563eb",toggleBackgroundColor:"#2563eb",toggleTextColor:"#ffffff",toggleIconColor:"#2563eb"},t.defaultAssets={logo:g,headerLogo:g},t.defaultIcons={closeIcon:"/icons/close-icon.svg",sendIcon:"/icons/send-icon.svg",minimizeIcon:"/icons/minimize-icon.svg",maximizeIcon:"/icons/maximize-icon.svg",expandIcon:"/icons/resize-icon.svg",reduceIcon:"/icons/resize-icon.svg"},t}(),v=function(){return v=Object.assign||function(t){for(var e,n=1,a=arguments.length;n<a;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},v.apply(this,arguments)},y=function(t,e,n){if(n||2===arguments.length)for(var a,o=0,i=e.length;o<i;o++)!a&&o in e||(a||(a=Array.prototype.slice.call(e,0,o)),a[o]=e[o]);return t.concat(a||Array.prototype.slice.call(e))},x=function(){function t(t){this.state=t||{isOpen:!1,isExpanded:!1,isInitialized:!1,isSending:!1,messages:[],error:void 0,pendingAttachments:[],isUploadingFiles:!1},this.listeners=new Set}return t.prototype.getState=function(){return v({},this.state)},t.prototype.subscribe=function(t){var e=this;return this.listeners.add(t),function(){return e.listeners.delete(t)}},t.prototype.setState=function(t){var e=this.state;this.state=v(v({},this.state),t),JSON.stringify(e)!==JSON.stringify(this.state)&&this.notifyListeners()},t.prototype.notifyListeners=function(){var t=this;this.listeners.forEach((function(e){return e(t.getState())}))},t.prototype.toggleChat=function(){this.setState({isOpen:!this.state.isOpen})},t.prototype.toggleExpand=function(){this.setState({isExpanded:!this.state.isExpanded})},t.prototype.setOpen=function(t){this.setState({isOpen:t})},t.prototype.setInitialized=function(t){this.setState({isInitialized:t})},t.prototype.setSending=function(t){this.setState({isSending:t})},t.prototype.addMessage=function(t){this.setState({messages:y(y([],this.state.messages,!0),[t],!1)})},t.prototype.setError=function(t){this.setState({error:t})},t.prototype.clearMessages=function(){this.setState(v(v({},this.state),{messages:[]}))},t.prototype.setMessages=function(t){this.setState(v(v({},this.state),{messages:t}))},t.prototype.updateMessage=function(t,e){var n=this.state.messages.map((function(n){return n.id===t?v(v({},n),e):n}));this.setState({messages:n})},t.prototype.deleteMessage=function(t){var e=this.state.messages.filter((function(e){return e.id!==t}));this.setState({messages:e})},t.prototype.getMessageById=function(t){return this.state.messages.find((function(e){return e.id===t}))},t.prototype.getLastMessage=function(){return this.state.messages[this.state.messages.length-1]},t.prototype.getMessageCount=function(){return this.state.messages.length},t.prototype.clearListeners=function(){this.listeners.clear()},t.prototype.addPendingAttachment=function(t){this.setState(v(v({},this.state),{pendingAttachments:y(y([],this.state.pendingAttachments,!0),[t],!1)}))},t.prototype.updatePendingAttachment=function(t,e){this.setState(v(v({},this.state),{pendingAttachments:this.state.pendingAttachments.map((function(n){return n.file_id===t?v(v({},n),e):n}))}))},t.prototype.updateAttachmentStatus=function(t,e){var n=this.state.pendingAttachments.map((function(n){return n.file_id===t?v(v({},n),e):n}));this.setState({pendingAttachments:n})},t.prototype.removePendingAttachment=function(t){var e=this.state.pendingAttachments.filter((function(e){return e.file_id!==t}));this.setState({pendingAttachments:e})},t.prototype.clearPendingAttachments=function(){this.setState({pendingAttachments:[]})},t.prototype.getPendingAttachments=function(){return y([],this.state.pendingAttachments,!0)},t.prototype.setUploadingFiles=function(t){this.setState({isUploadingFiles:t})},t}(),b='\n  :root{\n    --am-bg-item-hover:#eef3ff;\n    --am-bg-item-active:#dbeafe;\n    --am-text-muted:#6b7280;\n    --am-bg-badge:#ef4444;\n  }\n\n  .am-chat-widget {\n    font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, Helvetica, Arial, sans-serif;\n    z-index: 1000;\n    height: 100%;\n    display: flex;\n    flex-direction: column;\n  }\n\n  .am-chat-container {\n    background: var(--chat-background-color, #FFFFFF);\n    flex-direction: column;\n    overflow: hidden;\n    display: flex;\n    width: 480px;\n    height: 600px;\n    border-radius: 8px;\n    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);\n    flex: 1;\n  }\n\n  .am-chat-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 12px 16px;\n    border-bottom: 1px solid rgba(0, 0, 0, 0.1);\n    height: 54px;\n    background: white !important;\n    color: #111827 !important;\n    box-sizing: border-box;\n  }\n\n  .am-chat-header-content {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    width: 100%;\n    gap: 8px;\n  }\n\n  .am-chat-logo-title {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    font-size: 16px;\n    font-weight: normal;\n    color: #111827;\n    flex-shrink: 1;\n    min-width: 0;\n  }\n  \n  .am-chat-logo-title span {\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n  }\n\n  /* Hamburger menu button */\n  .am-hamburger {\n    background: none;\n    border: none;\n    cursor: pointer;\n    padding: 4px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: inherit;\n    margin-right: 4px;\n  }\n\n  .am-chat-logo {\n    width: 28px;\n    height: 28px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    flex-shrink: 0;\n  }\n\n  .am-chat-logo svg {\n    width: 100%;\n    height: 100%;\n  }\n\n  .am-chat-header-logo {\n    width: 32px;\n    height: 32px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    flex-shrink: 0;\n  }\n\n  .am-chat-header-logo svg {\n    width: 100%;\n    height: 100%;\n  }\n\n  .am-chat-header h3 {\n    margin: 0;\n    font-size: 16px;\n    font-weight: 500;\n    color: inherit !important;\n  }\n\n  .am-chat-header button {\n    background: none;\n    padding: 4px;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  }\n\n  .am-chat-header button svg {\n    width: 18px;\n    height: 18px;\n    fill: var(--chat-header-text-color, #FFFFFF);\n  }\n\n  .am-chat-header button:hover {\n    opacity: 0.8;\n  }\n\n  .am-chat-header-actions {\n    display: flex;\n    align-items: center;\n    gap: 0px !important;\n    flex-shrink: 0;\n  }\n\n  .am-chat-header-button {\n    background: none;\n    border: none;\n    padding: 6px;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: background-color 0.2s;\n    border-radius: 4px;\n    color: #6b7280 !important;\n  }\n\n  .am-chat-header-button:hover {\n    background: rgba(0, 0, 0, 0.05) !important;\n    color: #374151 !important;\n  }\n\n  .am-chat-header-button svg {\n    width: 18px;\n    height: 18px;\n    display: block;\n    margin: auto;\n  }\n\n  /* For stroke-based icons (new collection) */\n  .am-chat-header-button svg[stroke],\n  .am-chat-header-button svg[stroke-width] {\n    stroke: #6b7280 !important;\n    fill: none !important;\n  }\n\n  .am-chat-header-button:hover svg[stroke],\n  .am-chat-header-button:hover svg[stroke-width] {\n    stroke: #374151 !important;\n    fill: none !important;\n  }\n\n  /* For fill-based icons (old collection) */\n  .am-chat-header-button svg[fill]:not([fill="none"]) {\n    fill: #6b7280 !important;\n  }\n\n  .am-chat-header-button:hover svg[fill]:not([fill="none"]) {\n    fill: #374151 !important;\n  }\n\n\n  .am-chat-messages {\n    flex: 1 1 auto;\n    overflow-y: auto;\n    padding: 1rem;\n    display: flex;\n    flex-direction: column;\n    gap: 1rem;\n  }\n\n  /* Stage-2 conversation drawer */\n  .am-drawer {\n    position: absolute;\n    left: 0;\n    top: 0;\n    height: 100%;\n    width: 240px;\n    transform: translateX(-100%);\n    transition: transform .2s ease-out;\n    background: #f5f5f5;\n    box-shadow: 2px 0 6px rgba(0,0,0,.08);\n    display: flex;\n    flex-direction: column;\n    z-index: 3;\n  }\n  .am-drawer.open {\n    transform: translateX(0);\n  }\n\n  .am-drawer header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    font-weight: 600;\n    padding: .6rem 1rem;\n    border-bottom: 1px solid #e5e7eb;\n  }\n  .am-drawer header button.am-new {\n    font-size: 1.1rem;\n    line-height: 1;\n    border: none;\n    background: var(--chat-header-background-color, #2563eb);\n    color: var(--chat-header-text-color, #FFFFFF);\n    cursor: pointer;\n    border-radius: 4px;\n    padding: 4px 8px;\n    font-weight: bold;\n  }\n  \n  .am-drawer button.am-close {\n    width: 100%;\n    padding: 8px;\n    margin-top: auto;\n    border: none;\n    background: #f0f0f0;\n    cursor: pointer;\n    border-top: 1px solid #e5e7eb;\n    font-size: 0.9rem;\n    text-align: center;\n  }\n\n  .am-drawer ul {\n    list-style: none;\n    margin: 0;\n    padding: .4rem 0;\n    flex: 1;\n    overflow-y: auto;\n  }\n  \n  /* drawer list styling */\n  .am-drawer li {\n    display: flex;\n    align-items: center;\n    gap: .5rem;\n    position: relative;\n    padding: .45rem 1rem;\n    cursor: pointer;\n  }\n  \n  .am-drawer li:hover {\n    background: var(--am-bg-item-hover);\n  }\n  \n  .am-drawer li.active {\n    background: var(--am-bg-item-active);\n  }\n  \n  .am-drawer li .title {\n    flex: 1;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n  }\n  \n  .am-drawer li .time {\n    font-size: .72rem;\n    color: var(--am-text-muted);\n  }\n  \n  .am-drawer li .badge {\n    background: var(--am-bg-badge);\n    color: #fff;\n    border-radius: 9999px;\n    font-size: .65rem;\n    padding: 0 .4em;\n    min-width: 1.2em;\n    text-align: center;\n  }\n\n  /* swipe hint overlay (mobile) */\n  @media(max-width:479px){\n    .am-drawer{\n      touch-action:pan-y;\n    }\n  }\n  \n  .am-drawer .am-close {\n    border: none;\n    background: none;\n    padding: .6rem 1rem;\n    text-align: left;\n    cursor: pointer;\n    border-top: 1px solid #e5e7eb;\n  }\n\n  .am-chat-avatar {\n    width: 32px;\n    height: 32px;\n    border-radius: 50%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    flex-shrink: 0;\n  }\n\n  .am-chat-avatar.agent {\n    background: var(--chat-header-background-color, #BE185D);\n  }\n\n  .am-chat-avatar.user {\n    background: var(--chat-user-background-color, #F43F5E);\n  }\n\n  .am-chat-avatar img, .am-chat-avatar svg {\n    width: 20px;\n    height: 20px;\n  }\n\n  .am-chat-avatar.agent svg {\n    fill: var(--chat-agent-icon-color, #FFFFFF);\n  }\n\n  .am-chat-avatar.user svg {\n    fill: var(--chat-user-icon-color, #FFFFFF);\n  }\n\n  .am-chat-branding {\n    text-align: left;\n    font-size: 10px;\n    padding: 4px 16px;\n    color: #9CA3AF;\n    background: white;\n  }\n\n  .am-chat-branding a {\n    color: #2563eb;\n    text-decoration: none;\n    font-weight: 500;\n  }\n\n  .am-chat-branding a:hover {\n    text-decoration: underline;\n  }\n\n  .am-chat-input-wrapper {\n    background: white;\n    border-top: 1px solid rgba(0, 0, 0, 0.05);\n    width: 100%;\n    display: flex;\n    flex-direction: column;\n  }\n\n  .am-chat-input-container {\n    display: flex;\n    align-items: center;\n    padding: 8px 16px;\n    gap: 8px;\n  }\n\n  .am-chat-input {\n    flex: 1;\n    min-height: 44px;\n    max-height: 120px;\n    padding: 10px 12px 6px 12px;\n    border: 1px solid rgba(0, 0, 0, 0.1);\n    border-radius: 8px;\n    font-size: 14px;\n    line-height: 20px;\n    resize: none;\n    overflow-y: auto;\n    background: white;\n    box-sizing: border-box;\n  }\n\n  .am-chat-send {\n    margin-left: 8px;\n    width: 32px;\n    height: 32px;\n    padding: 6px;\n    background: var(--chat-header-background-color, #2563eb);\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: filter 0.2s;\n  }\n\n  .am-chat-send:hover {\n    filter: brightness(1.5);\n  }\n\n  .am-chat-send:disabled {\n    cursor: not-allowed;\n    opacity: 0.8;\n  }\n\n  .am-chat-send svg {\n    width: 20px;\n    height: 20px;\n  }\n\n  .am-chat-send:disabled svg {\n    opacity: 0.8;\n  }\n\n  .am-chat-initializing {\n    padding: 16px;\n    text-align: center;\n    color: #6B7280;\n  }\n\n  .desktop-only {\n    display: none;\n  }\n\n  @media (min-width: 768px) {\n    .desktop-only {\n      display: flex;\n    }\n  }\n\n  .am-chat-toggle {\n    position: fixed;\n    bottom: 20px;\n    right: 20px;\n    border: none;\n    border-radius: 100px;\n    padding: 0;\n    cursor: pointer;\n    transition: transform 0.2s;\n    z-index: 1000;\n  }\n\n  .am-chat-toggle:hover {\n    transform: scale(1.05);\n  }\n\n  .am-chat-toggle-content {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    background: var(--chat-header-background-color, #2563eb);\n    color: var(--chat-header-text-color, #FFFFFF);\n    padding: 8px 16px 8px 8px;\n    border-radius: 100px;\n    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);\n  }\n\n  .am-chat-toggle-text {\n    font-size: 16px;\n    font-weight: 500;\n  }\n\n  .am-chat-expanded {\n    position: fixed !important;\n    top: 12px !important;\n    right: 0 !important;\n    bottom: 12px !important;\n    width: 100vw !important;\n    margin: 0 !important;\n    border-radius: 0 !important;\n    transition: all 0.3s ease-in-out !important;\n    display: flex !important;\n    justify-content: center !important;\n  }\n\n  .am-chat-expanded .am-chat-container {\n    width: 66.67vw !important;\n    max-width: 600px !important;\n    height: calc(95vh - 24px) !important;\n    border-radius: 8px !important;\n    transition: all 0.3s ease-in-out !important;\n  }\n\n  .am-chat-expanded .am-chat-messages {\n    height: calc(95vh - 148px) !important; /* 24px margins + 124px for header and input */\n  }\n\n  .am-chat-minimize {\n    border: none;\n    background: none;\n    cursor: pointer;\n  }\n\n  /* Override any external styles that might affect the header text */\n  .am-chat-header * {\n    color: inherit !important;\n  }\n',w='\n  .am-message {\n    margin-bottom: 18px;\n    display: flex;\n    flex-direction: column;\n    align-items: flex-start;\n    width: 100%;\n  }\n\n  .am-message.user {\n    margin-top: 24px;\n    margin-bottom: 18px;\n  }\n\n  .am-message-content {\n    padding: 0;\n    border-radius: 0;\n    font-size: 14px;\n    width: 100%;\n    word-wrap: break-word;\n    line-height: 1.6;\n    background: none;\n    border: none;\n  }\n\n  .am-message.agent .am-message-content {\n    color: #111827;\n  }\n\n  .am-message.user .am-message-content {\n    color: #111827;\n  }\n\n  /* Role labels */\n  .am-message-role {\n    font-size: 12px;\n    font-weight: 600;\n    color: #6b7280;\n    margin-bottom: 8px;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n  }\n\n  .am-message.agent .am-message-role {\n    color: #111827;\n  }\n\n  .am-message.user .am-message-role {\n    color: #2563eb;\n  }\n\n  // Content formatting - Reduce spacing\n  .am-message.agent .am-message-content br {\n    content: "";\n    display: block;\n    margin-top: 0.2em;\n  }\n\n  .am-message-avatar {\n    width: 24px;\n    height: 24px;\n    flex-shrink: 0;\n    display: inline-flex;\n    align-items: center;\n    margin-top: 4px;\n  }\n\n  .am-message-avatar img {\n    width: 100%;\n    height: 100%;\n    border-radius: 50%;\n  }\n\n  .am-message.user .am-message-avatar {\n    width: 28px;\n    height: 28px;\n    margin-top: 16px;\n  }\n  \n\n  /* Typography and spacing */\n  .am-message-content p {\n    margin: 0 0 8px 0;\n  }\n\n  .am-message-content p:last-child {\n    margin-bottom: 0;\n  }  \n\n  /* Enhanced Lists styling */\n  .am-message-content ul,\n  .am-message-content ol {\n    margin: 4px 0;\n    padding-left: 20px;\n    list-style-position: outside;\n  }\n\n  .am-message-content ul {\n    list-style-type: disc;\n  }\n\n  .am-message-content ol {\n    list-style-type: decimal;\n  }\n\n  /* Nested lists */\n  .am-message-content ul ul,\n  .am-message-content ol ul {\n    list-style-type: circle;\n  }\n\n  .am-message-content ul ul ul,\n  .am-message-content ol ul ul {\n    list-style-type: square;\n  }\n\n  .am-message-content ol ol,\n  .am-message-content ul ol {\n    list-style-type: lower-alpha;\n  }\n\n  .am-message-content ol ol ol,\n  .am-message-content ul ol ol {\n    list-style-type: lower-roman;\n  }\n\n  .am-message-content li {\n    margin: 4px 0;\n    padding-left: 4px;\n    line-height: 1.4;\n    display: list-item; /* Ensures list markers are visible */\n  }\n\n  /* Remove margins for nested lists */\n  .am-message-content li > ul,\n  .am-message-content li > ol {\n    margin: 2px 0;\n  }\n\n  /* Links styling */\n  .am-message-content a {\n    color: #2563eb;\n    text-decoration: none;\n    font-weight: 500;\n  }\n\n  .am-message.user .am-message-content a {\n    color: inherit;\n  }\n\n  .am-message-content a:hover {\n    text-decoration: underline;\n  }\n\n  /* Strong and emphasis */\n  .am-message-content strong {\n    font-weight: 600;\n  }\n\n  .am-message-content em {\n    font-style: italic;\n  }  \n\n  .am-message-content h1,\n  .am-message-content h2,\n  .am-message-content h3,\n  .am-message-content h4,\n  .am-message-content h5,\n  .am-message-content h6 {\n    font-weight: 500;\n    line-height: 1.3;\n    margin: 16px 0 8px 0;  \n  }\n\n  .am-message-content h2,\n  .am-message-content h3 {\n    margin-top: 24px;  /* More space above section headers */\n    margin-bottom: 12px;  /* More space below before content */\n  }  \n\n  .am-message-content h1 { font-size: 1.4em; }\n  .am-message-content h2 { font-size: 1.3em; }\n  .am-message-content h3 { font-size: 1.2em; }\n  .am-message-content h4 { font-size: 1.1em; }\n  .am-message-content h5 { font-size: 1em; }\n  .am-message-content h6 { font-size: 0.9em; }\n\n  /* Ensure first and last headings don\'t add extra spacing */\n  .am-message-content > h1:first-child,\n  .am-message-content > h2:first-child,\n  .am-message-content > h3:first-child,\n  .am-message-content > h4:first-child,\n  .am-message-content > h5:first-child,\n  .am-message-content > h6:first-child {\n    margin-top: 0;\n  }\n\n  .am-message-content > h1:last-child,\n  .am-message-content > h2:last-child,\n  .am-message-content > h3:last-child,\n  .am-message-content > h4:last-child,\n  .am-message-content > h5:last-child,\n  .am-message-content > h6:last-child {\n    margin-bottom: 0;\n  }\n\n  /* Add space after paragraphs */\n  .am-message-content p + h1,\n  .am-message-content p + h2,\n  .am-message-content p + h3,\n  .am-message-content p + h4,\n  .am-message-content p + h5,\n  .am-message-content p + h6 {\n    margin-top: 24px;  /* More space when heading follows paragraph */\n  }  \n\n  /* Adjust list spacing after headers */\n  .am-message-content h1 + ul,\n  .am-message-content h2 + ul,\n  .am-message-content h3 + ul,\n  .am-message-content h4 + ul,\n  .am-message-content h5 + ul,\n  .am-message-content h6 + ul {\n    margin-top: 12px;\n  }\n\n\n  /* Code blocks */\n  .am-message-content code {\n    background: rgba(0, 0, 0, 0.05);\n    padding: 2px 4px;\n    border-radius: 4px;\n    font-family: monospace;\n    font-size: 0.9em;\n  }\n\n  .am-message-content pre {\n    background: rgba(0, 0, 0, 0.05);\n    padding: 12px;\n    border-radius: 8px;\n    overflow-x: auto;\n    margin: 8px 0;\n  }\n\n  .am-message-content pre code {\n    background: none;\n    padding: 0;\n  }\n\n  /* Blockquotes */\n  .am-message-content blockquote {\n    border-left: 4px solid #2563eb;\n    margin: 8px 0;\n    padding: 4px 12px;\n    color: #4b5563;\n  }\n\n  /* Tables */\n  .am-message-content table {\n    border-collapse: collapse;\n    width: 100%;\n    margin: 8px 0;\n  }\n\n  .am-message-content th,\n  .am-message-content td {\n    border: 1px solid rgba(0, 0, 0, 0.1);\n    padding: 8px;\n    text-align: left;\n  }\n\n  .am-message-content th {\n    background: rgba(0, 0, 0, 0.05);\n    font-weight: 600;\n  }\n\n  /* Remove margin top from first element */\n  .am-message-content > *:first-child {\n    margin-top: 0;\n  }\n\n  /* Remove margin bottom from last element */\n  .am-message-content > *:last-child {\n    margin-bottom: 0;\n  }\n\n\n  @media (max-width: 480px) {\n    .am-message-content {\n      font-size: 13px;\n      padding: 10px 14px;\n    }\n    \n    .am-message-content ul,\n    .am-message-content ol {\n      padding-left: 20px;\n    }\n  }\n',C={corner:"\n      .am-chat-widget--corner {\n        position: fixed;\n        bottom: var(--chat-bottom, 12px);\n        right: var(--chat-right, 12px);\n        z-index: var(--chat-z-index, 1000);\n      }\n  \n      .am-chat-widget--corner .am-chat-container {\n        position: fixed;\n        bottom: var(--chat-container-bottom, 20px);\n        right: var(--chat-container-right, 20px);\n        width: var(--chat-container-width, 480px);\n        height: var(--chat-container-height, 600px);\n      }\n\n      .am-chat-widget--corner .am-chat-toggle {\n        position: fixed !important;\n        bottom: var(--chat-toggle-bottom, 12px) !important;\n        right: var(--chat-toggle-right, 12px) !important;\n        padding: 0 !important;\n        border: none !important;\n        background: var(--chat-toggle-background-color, var(--chat-header-background-color, #2563eb)) !important;\n        cursor: pointer !important;\n        z-index: var(--chat-z-index, 1000)\n        border-radius: 32px !important;\n        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15) !important;\n        transition: transform 0.2s !important;\n        text-transform: none !important;\n        letter-spacing: normal !important;\n        line-height: normal !important;\n        text-decoration: none !important;\n        min-width: auto !important;\n        min-height: auto !important;\n        max-width: none !important;\n        max-height: none !important;\n        width: auto !important;\n        height: auto !important;\n        margin: 0 !important;\n      }\n\n      .am-chat-widget--corner .am-chat-toggle:hover {\n        transform: translateY(-1px) !important;\n        background: var(--chat-toggle-background-color, var(--chat-header-background-color, #2563eb)) !important;\n        color: var(--chat-toggle-text-color, var(--chat-header-text-color, #FFFFFF)) !important;\n        text-decoration: none !important;\n        border: none !important;\n        outline: none !important;\n      }\n      \n      .am-chat-widget--corner .am-chat-toggle:focus {\n        outline: none !important;\n        box-shadow: 0 0 0 2px rgba(5, 150, 105, 0.5) !important;\n      }\n\n      .am-chat-widget--corner .am-chat-toggle-content {\n        display: flex !important;\n        align-items: center !important;\n        gap: 4px !important;\n        padding: 8px 12px !important;\n        text-transform: none !important;\n        letter-spacing: normal !important;\n        line-height: normal !important;\n        text-decoration: none !important;\n        margin: 0 !important;\n      }\n\n      .am-chat-widget--corner .am-chat-toggle img {\n        width: 24px !important;\n        height: 24px !important;\n        border-radius: 50% !important;\n        max-width: 24px !important;\n        max-height: 24px !important;\n        min-width: 24px !important;\n        min-height: 24px !important;\n        padding: 0 !important;\n        margin: 0 !important;\n        display: inline-block !important;\n        vertical-align: middle !important;\n      }\n\n      .am-chat-widget--corner .am-chat-toggle-text {\n        color: var(--chat-toggle-text-color, var(--chat-header-text-color, #FFFFFF)) !important;\n        font-size: 16px !important;\n        font-weight: 500 !important;\n        text-transform: none !important;\n        letter-spacing: normal !important;\n        text-decoration: none !important;\n      }\n\n      @media (max-width: 640px) {\n        .am-chat-widget--corner .am-chat-toggle {\n          border-radius: 20px;\n        }\n\n        .am-chat-widget--corner .am-chat-toggle-content {\n          padding: 8px 12px;\n          gap: 6px;\n        }\n\n        .am-chat-widget--corner .am-chat-toggle img {\n          width: 20px;\n          height: 20px;\n        }\n\n        .am-chat-widget--corner .am-chat-toggle-text {\n          font-size: 13px;\n        }\n      }\n    ",centered:"\n      .am-chat-widget--centered {\n        position: absolute;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        padding: 1rem;\n        inset: var(--chat-inset, 64px 0 0 0);\n      }\n  \n      .am-chat-widget--centered .am-chat-container {\n        width: var(--chat-container-width, 100%);\n        max-width: var(--chat-container-max-width, 500px);\n        height: var(--chat-container-height, 600px);\n        margin: auto;\n        border-radius: var(--chat-container-radius, 8px);\n        display: flex !important;\n        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n      }\n    ",inline:"\n      .am-chat-widget--inline {\n        position: relative;\n        width: 100%;\n        height: 100%;\n        display: flex;\n        flex-direction: column;\n      }\n  \n      .am-chat-widget--inline .am-chat-container {\n        position: relative;\n        width: 100%;\n        height: 100%;\n        box-shadow: none;\n        border-radius: 8px;\n        display: flex;\n        flex-direction: column;\n        border: 1px solid rgba(0, 0, 0, 0.1);\n      }\n\n      .am-chat-widget--inline .am-chat-messages {\n        flex: 1 1 auto;\n        height: 0;\n        min-height: 0;\n      }\n\n      .am-chat-widget--inline .am-chat-input-container {\n        flex: 0 0 auto;\n        border-top: 1px solid rgba(0, 0, 0, 0.1);\n      }\n    "},k="\n  .am-chat-loading-message {\n    padding: 8px 16px;\n    margin: 8px 0;\n    opacity: 1;\n    transition: opacity 0.15s ease-out;\n  }\n\n  .am-chat-loading-message.loading-fade-out {\n    opacity: 0;\n  }\n\n  .am-chat-loading-container {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    padding: 8px;\n    border-radius: 12px;\n  }\n\n  @keyframes loading-animation {\n    0%, 80%, 100% { transform: scaleY(1); }\n    40% { transform: scaleY(1.5); }\n  }\n",M="\n  @media (max-width: 640px) {\n    .am-chat-widget--corner .am-chat-container {\n      width: 100%;\n      height: 100vh;\n      bottom: 0;\n      right: 0;\n      border-radius: 0;\n    }\n\n    .am-chat-widget--centered {\n      max-width: 100%;\n      margin: 0 16px;\n    }\n    \n    .desktop-only {\n      display: none !important;\n    }\n  }\n\n  @media (max-width: 480px) {\n    .am-chat-widget--centered {\n      margin: 0;\n    }\n\n    .am-chat-widget--centered .am-chat-container {\n      border-radius: 0;\n    }\n  }\n",S="\n  \n  .am-chat-svg-container {\n    margin: 8px 0;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    border-radius: 4px;\n    padding: 4px;\n  }\n\n  .am-chat-svg-wrapper {\n    width: 200px;  // Back to original size\n    height: auto;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n  }\n\n  .am-chat-svg-wrapper svg {\n    width: 100%;\n    height: auto;\n    display: block;\n  }\n\n  .am-chat-svg-wrapper.small {\n    width: 100px;\n  }\n  .am-chat-svg-wrapper.medium {\n    width: 200px;\n  }\n  .am-chat-svg-wrapper.large {\n    width: 300px;\n  }   \n\n",I="\n  .am-chat-loading-message {\n    padding: 0 !important;\n    margin-bottom: 18px !important;\n    margin-top: 0 !important;\n    opacity: 1;\n    transition: opacity 0.15s ease-out;\n    display: flex !important;\n    flex-direction: column !important;\n    align-items: flex-start !important;\n    width: 100% !important;\n  }\n\n  .am-chat-loading-message .am-message-role {\n    font-size: 12px !important;\n    font-weight: 600 !important;\n    color: #111827 !important;\n    margin-bottom: 8px !important;\n    margin-top: 0 !important;\n    margin-left: 0 !important;\n    margin-right: 0 !important;\n    text-transform: uppercase !important;\n    letter-spacing: 0.5px !important;\n    padding: 0 !important;\n    text-align: left !important;\n  }\n\n  .am-chat-loading-message .am-message-content {\n    padding: 0 !important;\n    margin: 0 !important;\n    border-radius: 0 !important;\n    font-size: 14px !important;\n    width: 100% !important;\n    word-wrap: break-word !important;\n    line-height: 1.6 !important;\n    background: none !important;\n    border: none !important;\n    color: #111827 !important;\n    text-align: left !important;\n  }\n\n  .am-chat-loading-message.loading-fade-out {\n    opacity: 0;\n  }\n\n  .loading-container {\n    display: flex !important;\n    align-items: center !important;\n    justify-content: flex-start !important;\n    padding: 0 !important;\n    margin: 0 !important;\n    border-radius: 0 !important;\n    width: 100% !important;\n    text-align: left !important;\n  }\n\n  .loading-waves {\n    display: flex !important;\n    align-items: center !important;\n    justify-content: flex-start !important;\n    gap: 2px !important;\n    height: 24px !important;\n    padding: 0 !important;\n    margin: 0 !important;\n    text-align: left !important;\n  }\n\n  .loading-waves span {\n    display: inline-block;\n    width: 4px;\n    height: 4px;\n    background-color: var(--chat-secondary-color, #666);\n    border-radius: 50%;\n    animation: wave-loading 1.4s infinite ease-in-out both;\n  }\n\n  .loading-waves span:nth-child(1) {\n    animation-delay: -0.32s;\n  }\n\n  .loading-waves span:nth-child(2) {\n    animation-delay: -0.16s;\n  }\n\n  .loading-waves span:nth-child(3) {\n    animation-delay: 0s;\n  }\n\n  .loading-waves span:nth-child(4) {\n    animation-delay: 0.16s;\n  }\n\n  .loading-waves span:nth-child(5) {\n    animation-delay: 0.32s;\n  }\n\n  @keyframes wave-loading {\n    0%, 80%, 100% {\n      transform: scale(0.8) translateY(0);\n      opacity: 0.5;\n    }\n    40% {\n      transform: scale(1.2) translateY(-8px);\n      opacity: 1;\n    }\n  }\n\n  /* Alternative typing dots animation */\n  .loading-dots {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    height: 24px;\n  }\n\n  .loading-dots span {\n    display: inline-block;\n    width: 6px;\n    height: 6px;\n    background-color: var(--chat-secondary-color, #666);\n    border-radius: 50%;\n    animation: typing-dots 1.4s infinite ease-in-out;\n  }\n\n  .loading-dots span:nth-child(1) {\n    animation-delay: 0s;\n  }\n\n  .loading-dots span:nth-child(2) {\n    animation-delay: 0.2s;\n  }\n\n  .loading-dots span:nth-child(3) {\n    animation-delay: 0.4s;\n  }\n\n  @keyframes typing-dots {\n    0%, 60%, 100% {\n      transform: translateY(0);\n      opacity: 0.4;\n    }\n    30% {\n      transform: translateY(-10px);\n      opacity: 1;\n    }\n  }\n",A="\n  /* Input Prompts Container - DISABLED due to UX issues */\n  /* Keeping styles for potential future use */\n  .am-chat-input-prompts {\n    display: none !important; /* Force hide due to UX issues */\n    flex-wrap: wrap;\n    gap: 8px;\n    padding: 12px 16px 8px 16px;\n    background: var(--chat-background-color, #ffffff);\n    border-bottom: 1px solid #e5e7eb;\n  }\n\n  /* Individual Prompt Buttons */\n  .am-chat-input-prompt-btn {\n    background-color: #f3f4f6;\n    color: #374151;\n    border: 1px solid #d1d5db;\n    border-radius: 16px;\n    padding: 6px 12px;\n    font-size: 13px;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    line-height: 1.2;\n    white-space: nowrap;\n    max-width: 200px;\n    overflow: hidden;\n    text-overflow: ellipsis;\n  }\n\n  .am-chat-input-prompt-btn:hover {\n    background-color: var(--chat-button-color, #2563eb);\n    color: var(--chat-button-text-color, #ffffff);\n    border-color: var(--chat-button-color, #2563eb);\n    transform: translateY(-1px);\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n  }\n\n  .am-chat-input-prompt-btn:active {\n    transform: translateY(0);\n    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n  }\n\n  /* Hide prompts when input is focused and has content */\n  .am-chat-input:focus ~ .am-chat-input-prompts,\n  .am-chat-input:not(:placeholder-shown) ~ .am-chat-input-prompts {\n    opacity: 0.7;\n  }\n\n  /* Responsive adjustments */\n  @media (max-width: 480px) {\n    .am-chat-input-prompts {\n      padding: 8px 12px 6px 12px;\n      gap: 6px;\n    }\n\n    .am-chat-input-prompt-btn {\n      font-size: 12px;\n      padding: 5px 10px;\n      max-width: 150px;\n    }\n  }\n\n  /* Animation for showing/hiding prompts - DISABLED */\n  /* .am-chat-input-prompts {\n    transition: opacity 0.3s ease, transform 0.3s ease;\n  } */\n\n  .am-chat-input-prompts[style*=\"display: none\"] {\n    opacity: 0;\n    transform: translateY(-5px);\n  }\n\n  /* ===== FLOATING PROMPT BUBBLES (When widget is closed) ===== */\n  \n  .am-chat-floating-prompts-container {\n    position: fixed;\n    bottom: 80px; /* Above the toggle button */\n    right: 20px;\n    max-width: 320px;\n    z-index: 999; /* Below the toggle button which is 1000 */\n    opacity: 0;\n    transform: translateY(10px);\n    transition: all 0.3s ease;\n  }\n\n  /* Show animation */\n  .am-chat-floating-prompts-container {\n    animation: fadeInUp 0.3s ease forwards;\n  }\n\n  @keyframes fadeInUp {\n    from {\n      opacity: 0;\n      transform: translateY(10px);\n    }\n    to {\n      opacity: 1;\n      transform: translateY(0);\n    }\n  }\n\n  /* Left-aligned for bottom-left corner widget */\n  .am-chat-bottom-left .am-chat-floating-prompts-container {\n    right: auto;\n    left: 20px;\n  }\n\n  /* Welcome message bubble */\n  .am-chat-floating-welcome-message {\n    background: white;\n    border-radius: 16px;\n    padding: 16px;\n    margin-bottom: 12px;\n    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);\n    border: 1px solid #e5e7eb;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\n  }\n\n  .am-chat-floating-welcome-header {\n    display: flex;\n    align-items: center;\n  }\n\n  .am-chat-floating-welcome-avatar {\n    width: 32px;\n    height: 32px;\n    border-radius: 50%;\n    background-color: var(--chat-button-color, #2563eb);\n    margin-right: 12px;\n    flex-shrink: 0;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: white;\n  }\n\n  .am-chat-floating-welcome-avatar svg {\n    width: 18px;\n    height: 18px;\n  }\n\n  .am-chat-floating-welcome-text {\n    font-weight: 500;\n    font-size: 14px;\n    color: #111827;\n    line-height: 1.4;\n  }\n\n  /* Floating prompt buttons container */\n  .am-chat-floating-message-prompts {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n    align-items: flex-end; /* Right-align buttons */\n  }\n\n  /* Individual floating prompt buttons */\n  .am-chat-floating-message-prompt {\n    background: white;\n    color: #374151;\n    border: 1px solid #e5e7eb;\n    border-radius: 20px;\n    padding: 12px 16px;\n    font-size: 14px;\n    font-weight: 500;\n    cursor: pointer;\n    text-align: left;\n    transition: all 0.2s ease;\n    line-height: 1.3;\n    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n    max-width: 100%;\n    word-wrap: break-word;\n    font-family: inherit;\n  }\n\n  .am-chat-floating-message-prompt:hover {\n    background: var(--chat-button-color, #2563eb);\n    color: var(--chat-button-text-color, #ffffff);\n    transform: translateY(-1px);\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n  }\n\n  .am-chat-floating-message-prompt:active {\n    transform: translateY(0);\n  }\n\n  /* Hide floating prompts on mobile devices */\n  @media (max-width: 768px) {\n    .am-chat-floating-prompts-container {\n      display: none !important;\n    }\n  }\n\n  /* Responsive adjustments for smaller screens */\n  @media (max-width: 480px) {\n    .am-chat-floating-prompts-container {\n      right: 12px;\n      max-width: 280px;\n    }\n    \n    .am-chat-floating-welcome-message {\n      padding: 12px;\n    }\n    \n    .am-chat-floating-message-prompt {\n      font-size: 13px;\n      padding: 10px 14px;\n    }\n  }\n",L=n(144),E="\n  /* Conversation List View (replaces entire chat area - messages and input) */\n  .am-conversation-list-view {\n    display: none;\n    flex-direction: column;\n    flex: 1;\n    background: var(--chat-background-color, #ffffff);\n    overflow: hidden;\n    position: absolute;\n    top: 60px; /* Below header */\n    left: 0;\n    right: 0;\n    bottom: 60px; /* Above branding */\n    transform: translateX(100%);\n    transition: transform 0.3s ease-in-out;\n  }\n\n  /* Animation states */\n  .am-conversation-list-view.opening {\n    display: flex;\n    transform: translateX(0);\n  }\n\n  .am-conversation-list-view.closing {\n    transform: translateX(100%);\n  }\n\n  /* Chat area animation */\n  .am-chat-messages,\n  .am-chat-input-prompts,\n  .am-chat-input-container,\n  .chat-attachments-preview {\n    transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;\n  }\n\n  .am-chat-messages.sliding-out,\n  .am-chat-input-prompts.sliding-out,\n  .am-chat-input-container.sliding-out,\n  .chat-attachments-preview.sliding-out {\n    transform: translateX(-100%);\n    opacity: 0;\n  }\n\n  .am-conversation-list-container {\n    display: flex;\n    flex-direction: column;\n    height: 100%;\n  }\n\n  /* New conversation button in header */\n  .am-conversation-new-header {\n    background: transparent;\n    border: none;\n    color: var(--chat-header-text-color, #ffffff);\n    cursor: pointer;\n    padding: 6px 8px;\n    border-radius: 4px;\n    font-size: 16px;\n    transition: background-color 0.2s;\n  }\n\n  .am-conversation-new-header:hover {\n    background: rgba(255, 255, 255, 0.1) !important;\n  }\n\n  /* Header buttons with text labels */\n  .am-header-button-with-text {\n    display: flex !important;\n    align-items: center;\n    gap: 4px;\n    padding: 0 0px !important;\n    min-width: auto !important;\n  }\n\n  .am-header-button-with-text svg {\n    width: 18px;\n    height: 18px;\n    flex-shrink: 0;\n  }\n\n  .am-button-label {\n    font-size: 12px;\n    font-weight: 400;\n    color: var(--chat-header-text-color, #ffffff);\n    white-space: nowrap;\n  }\n\n  /* Conversation indicator - small dot to show there are conversations */\n  .am-conversation-indicator {\n    position: absolute;\n    top: 6px;\n    right: 6px;\n    width: 5px;\n    height: 5px;\n    background-color: var(--chat-button-color, #2563eb);\n    border-radius: 50%;\n    display: none; /* Hide for now since we have text labels */\n  }\n\n  .am-conversation-toggle {\n    position: relative;\n  }\n\n  /* Header divider */\n  .am-header-divider {\n    width: 1px;\n    height: 24px;\n    background-color: #111827;\n    opacity: 0.15;\n    margin: 0 4px;\n    flex-shrink: 0;\n  }\n\n  /* Conversation List */\n  .am-conversation-list {\n    flex: 1;\n    overflow-y: auto;\n    padding: 0;\n  }\n\n  .am-conversation-item {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 12px 20px;\n    border-bottom: 1px solid #f3f4f6;\n    cursor: pointer;\n    transition: background-color 0.2s;\n  }\n\n  .am-conversation-item:hover {\n    background: #f9fafb;\n  }\n\n  .am-conversation-item.active {\n    background: #eff6ff;\n    border-left: 3px solid var(--chat-button-color, #2563eb);\n  }\n\n  .am-conversation-info {\n    flex: 1;\n    min-width: 0;\n  }\n\n  .am-conversation-title {\n    font-weight: 500;\n    font-size: 14px;\n    color: #111827;\n    margin-bottom: 4px;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n  }\n\n  .am-conversation-date {\n    font-size: 12px;\n    color: #6b7280;\n  }\n\n  .am-conversation-actions {\n    display: flex;\n    gap: 4px;\n    opacity: 0;\n    transition: opacity 0.2s;\n  }\n\n  .am-conversation-item:hover .am-conversation-actions {\n    opacity: 1;\n  }\n\n  .am-conversation-delete {\n    background: transparent;\n    border: none;\n    color: #dc2626;\n    cursor: pointer;\n    padding: 2px 6px;\n    border-radius: 4px;\n    font-size: 14px;\n    font-weight: bold;\n    transition: background-color 0.2s;\n  }\n\n  .am-conversation-delete:hover {\n    background: #fef2f2;\n  }\n\n  /* Empty State */\n  .am-conversation-empty {\n    padding: 40px 20px;\n    text-align: center;\n    color: #6b7280;\n  }\n\n  .am-conversation-empty p {\n    margin: 0 0 16px 0;\n    font-size: 14px;\n  }\n\n  .am-conversation-new-button {\n    background: var(--chat-button-color, #2563eb);\n    color: var(--chat-button-text-color, #ffffff);\n    border: none;\n    padding: 8px 16px;\n    border-radius: 6px;\n    font-size: 14px;\n    cursor: pointer;\n    transition: background-color 0.2s;\n  }\n\n  .am-conversation-new-button:hover {\n    background: var(--chat-button-hover-color, #047857);\n  }\n\n  /* Header Navigation Buttons */\n  .am-conversation-toggle,\n  .am-conversation-back {\n    background: transparent;\n    border: none;\n    color: var(--chat-header-text-color, #ffffff);\n    cursor: pointer;\n    padding: 6px 8px;\n    border-radius: 4px;\n    font-size: 16px;\n    transition: background-color 0.2s;\n  }\n\n  .am-conversation-toggle:hover,\n  .am-conversation-back:hover {\n    background: rgba(255, 255, 255, 0.1);\n  }\n\n  .am-conversation-back {\n    font-size: 18px;\n    font-weight: bold;\n  }\n\n  /* Mobile Responsiveness */\n  @media (max-width: 768px) {\n    .am-conversation-drawer {\n      width: 280px;\n      left: -300px;\n    }\n    \n    .am-conversation-manager.open .am-conversation-drawer {\n      left: 0;\n    }\n  }\n\n  /* Overlay for mobile */\n  .am-conversation-overlay {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background: rgba(0, 0, 0, 0.5);\n    display: none;\n    z-index: 1000;\n  }\n\n  .am-conversation-manager.open .am-conversation-overlay {\n    display: block;\n  }\n\n  @media (max-width: 768px) {\n    .am-conversation-overlay {\n      display: none;\n    }\n    \n    .am-conversation-manager.open .am-conversation-overlay {\n      display: block;\n    }\n  }\n",z=function(){function t(t){this.styleElement=null,this.variant=t,this.styles=[b,w,S,I,A,L.W,E,C[this.variant],k,M].join("\n")}return t.prototype.injectStyles=function(){this.styleElement=document.createElement("style"),this.styleElement.textContent=this.styles,document.head.appendChild(this.styleElement)},t.prototype.updateStyles=function(t){this.variant=t,this.styleElement&&(this.styleElement.textContent=this.styles)},t.prototype.cleanup=function(){var t;null===(t=this.styleElement)||void 0===t||t.remove(),this.styleElement=null},t}(),T=function(){function t(){}return t.parse=function(t){if(null==t||"string"!=typeof t)return"";try{var e=t;return e=this.processEmojis(e),this.rules.codeBlock.pattern.test(e)&&(e=e.replace(this.rules.codeBlock.pattern,this.rules.codeBlock.replace)),e=e.replace(this.rules.h3.pattern,this.rules.h3.replace).replace(this.rules.h2.pattern,this.rules.h2.replace).replace(this.rules.h1.pattern,this.rules.h1.replace),e=(e=(e=(e=(e=this.processLists(e)).replace(this.rules.bold.pattern,this.rules.bold.replace).replace(this.rules.italic.pattern,this.rules.italic.replace).replace(this.rules.inlineCode.pattern,this.rules.inlineCode.replace)).replace(this.rules.autoEmail.pattern,this.rules.autoEmail.replace).replace(this.rules.markdownLink.pattern,this.rules.markdownLink.replace).replace(this.rules.autoLink.pattern,this.rules.autoLink.replace)).replace(this.rules.blockquote.pattern,this.rules.blockquote.replace)).replace(this.rules.lineBreak.pattern,this.rules.lineBreak.replace)}catch(e){return console.warn("Offline parser error:",e),this.escapeHtml(t)}},t.escapeHtml=function(t){if(null==t||"string"!=typeof t)return"";var e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"};return t.replace(/[&<>"'/]/g,(function(t){return e[t]}))},t.processEmojis=function(t){if(null==t||"string"!=typeof t)return"";for(var e=t,n=0,a=Object.entries(this.emojiMap);n<a.length;n++){var o=a[n],i=o[0],r=o[1],s=i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");e=e.replace(new RegExp(s,"g"),r)}return e},t.sanitizeUrl=function(t){if(null==t||"string"!=typeof t)return"#";try{var e=new URL(t);return["http:","https:","mailto:"].includes(e.protocol)?t:"#"}catch(t){return"#"}},t.processMarkdownLink=function(t,e){null!=t&&"string"==typeof t||(t=""),null!=e&&"string"==typeof e||(e="");var n=this.sanitizeUrl(e.trim()),a=this.escapeHtml(t);return'<a href="'.concat(n,'" target="_blank" rel="noopener noreferrer">').concat(a,"</a>")},t.processLists=function(t){var e=t;return e=this.processNumberedLists(e),this.processBulletLists(e)},t.processNumberedLists=function(t){for(var e=t.split("\n"),n=[],a=!1,o=[],i=0;i<e.length;i++){var r=e[i],s=r.match(/^\s*\d+\.\s+(.+)/);if(s)a||(a=!0,o=[]),o.push("<li>".concat(this.escapeHtml(s[1].trim()),"</li>"));else{if(a&&""===r.trim())continue;if(a&&r.match(/^\s+/)&&!r.match(/^\s*\d+\./))continue;a&&(n.push("<ol>".concat(o.join(""),"</ol>")),a=!1,o=[]),""!==r.trim()&&n.push(r)}}return a&&o.length>0&&n.push("<ol>".concat(o.join(""),"</ol>")),n.join("\n")},t.processBulletLists=function(t){for(var e=t.split("\n"),n=[],a=!1,o=[],i=0;i<e.length;i++){var r=e[i],s=r.match(/^\s*[-*+]\s+(.+)/);if(s)a||(a=!0,o=[]),o.push("<li>".concat(this.escapeHtml(s[1].trim()),"</li>"));else{if(a&&""===r.trim())continue;if(a&&r.match(/^\s+/)&&!r.match(/^\s*[-*+]\s/))continue;a&&(n.push("<ul>".concat(o.join(""),"</ul>")),a=!1,o=[]),""!==r.trim()&&n.push(r)}}return a&&o.length>0&&n.push("<ul>".concat(o.join(""),"</ul>")),n.join("\n")},t.isProcessedHtml=function(t){return/<[^>]+>/.test(t)},t.emojiMap={":)":"üòä",":-)":"üòä",":(":"üò¢",":-(":"üò¢",":D":"üòÉ",":-D":"üòÉ",":P":"üòõ",":-P":"üòõ",";)":"üòâ",";-)":"üòâ",":o":"üòÆ",":-o":"üòÆ","<3":"‚ù§Ô∏è","</3":"üíî",":+1:":"üëç",":-1:":"üëé",":fire:":"üî•",":rocket:":"üöÄ",":star:":"‚≠ê",":check:":"‚úÖ"},t.rules={h1:{pattern:/^#\s+(.+)$/gm,replace:function(e,n){return"<h1>".concat(t.escapeHtml(n),"</h1>")}},h2:{pattern:/^##\s+(.+)$/gm,replace:function(e,n){return"<h2>".concat(t.escapeHtml(n),"</h2>")}},h3:{pattern:/^###\s+(.+)$/gm,replace:function(e,n){return"<h3>".concat(t.escapeHtml(n),"</h3>")}},bold:{pattern:/\*\*(.*?)\*\*/g,replace:function(e,n){return"<strong>".concat(t.escapeHtml(n),"</strong>")}},italic:{pattern:/\*(.*?)\*/g,replace:function(e,n){return"<em>".concat(t.escapeHtml(n),"</em>")}},markdownLink:{pattern:/\[([^\]]+)\]\(([^)]+)\)/g,replace:function(e,n,a){var o=t.sanitizeUrl(a.trim()),i=t.escapeHtml(n);return'<a href="'.concat(o,'" target="_blank" rel="noopener noreferrer">').concat(i,"</a>")}},autoLink:{pattern:/(https?:\/\/[^\s<>"']+[^\s<>"'.,;:!?)])/g,replace:function(e,n){var a=t.sanitizeUrl(n);return'<a href="'.concat(a,'" target="_blank" rel="noopener noreferrer">').concat(t.escapeHtml(n),"</a>")}},inlineCode:{pattern:/`([^`]+)`/g,replace:function(e,n){return"<code>".concat(t.escapeHtml(n),"</code>")}},codeBlock:{pattern:/```([\s\S]*?)```/g,replace:function(e,n){return"<pre><code>".concat(t.escapeHtml(n),"</code></pre>")}},blockquote:{pattern:/^>\s+(.+)/gm,replace:function(e,n){return"<blockquote>".concat(t.escapeHtml(n),"</blockquote>")}},lineBreak:{pattern:/\n/g,replace:"<br>"},autoEmail:{pattern:/\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b/g,replace:function(e){return'<a href="mailto:'.concat(e,'">').concat(t.escapeHtml(e),"</a>")}}},t}(),_=function(){function t(t){this.emojiMap=t}return t.prototype.processText=function(t,e){var n=t;return!1!==e.enableMarkdown&&window.marked?(n=this.sanitizeText(n),window.marked.setOptions({gfm:!0,breaks:!0,headerIds:!1,mangle:!1,sanitize:!0}),n=(n=window.marked.parse(n)).replace(/<a\s+(?:[^>]*?)href="([^"]*)"([^>]*?)>/gi,'<a href="$1" target="_blank" rel="noopener noreferrer" $2>')):n=T.parse(n),n},t.prototype.sanitizeText=function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},t.prototype.replaceEmoji=function(t){var e=this;return t.replace(/:\)|:\(|:D|;\)|<3/g,(function(t){return e.emojiMap[t]||t}))},t.prototype.applyMarkdown=function(t){var e=t;return(e=e.replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank" rel="noopener noreferrer">$1</a>')).replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/\n/g,"<br>")},t}(),F=function(){function t(){}return t.prototype.containsSvg=function(t){return t.includes("<svg")&&t.includes("</svg>")},t.prototype.isPureSvg=function(t){var e=t.trim();return e.startsWith("<svg")&&e.endsWith("</svg>")},t.prototype.processSvg=function(t){var e=this.cleanSvg(t);return'<div class="chat-svg-wrapper">'.concat(e,"</div>")},t.prototype.splitContent=function(t){for(var e=[],n=0;;){var a=t.indexOf("<svg",n);if(-1===a){n<t.length&&e.push(t.slice(n));break}a>n&&e.push(t.slice(n,a));var o=t.indexOf("</svg>",a);if(-1===o){e.push(t.slice(n));break}e.push(t.slice(a,o+6)),n=o+6}return e},t.prototype.cleanSvg=function(t){return t.replace(/`/g,"").trim().replace(/^svg\s*/,"").replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/on\w+="[^"]*"/g,"").replace(/javascript:/g,"")},t}(),H={":)":"üòä",":(":"üò¢",":D":"üòÉ",";)":"üòâ","<3":"‚ù§Ô∏è",":+1:":"üëç",":-1:":"üëé",":wave:":"üëã",":thinking:":"ü§î",":bulb:":"üí°"},P=function(){return P=Object.assign||function(t){for(var e,n=1,a=arguments.length;n<a;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},P.apply(this,arguments)},j=function(){function t(){}return t.prototype.renderHtml=function(t){return this.sanitizeHtml(t)},t.prototype.renderCustom=function(t){if(!t.data)return t.content;switch(t.data.customType){case"image":return this.renderImage(t.data);case"button":return this.renderButton(t.data);case"card":return this.renderCard(t.data);case"carousel":return this.renderCarousel(t.data);case"quickReplies":return this.renderQuickReplies(t.data);default:return t.content}},t.prototype.renderImage=function(t){var e=t.url,n=t.alt,a=t.width,o=t.height;return'\n      <div class="chat-image">\n        <img \n          src="'.concat(this.sanitizeUrl(e),'" \n          alt="').concat(this.sanitizeText(n||""),'"\n          ').concat(a?'width="'.concat(a,'"'):"","\n          ").concat(o?'height="'.concat(o,'"'):"",'\n          loading="lazy"\n        >\n      </div>\n    ')},t.prototype.renderButton=function(t){var e=t.text,n=t.action,a=t.style,o=void 0===a?"primary":a;return'\n      <button \n        class="chat-button chat-button--'.concat(this.sanitizeText(o),'"\n        data-action="').concat(this.sanitizeText(n),'"\n      >\n        ').concat(this.sanitizeText(e),"\n      </button>\n    ")},t.prototype.renderCard=function(t){var e=this,n=t.title,a=t.description,o=t.image,i=t.buttons;return'\n      <div class="chat-card">\n        '.concat(o?this.renderImage(o):"",'\n        <div class="chat-card__content">\n          ').concat(n?'<h4 class="chat-card__title">'.concat(this.sanitizeText(n),"</h4>"):"","\n          ").concat(a?'<p class="chat-card__description">'.concat(this.sanitizeText(a),"</p>"):"","\n          ").concat(i?'\n            <div class="chat-card__actions">\n              '.concat(i.map((function(t){return e.renderButton(t)})).join(""),"\n            </div>\n          "):"","\n        </div>\n      </div>\n    ")},t.prototype.renderCarousel=function(t){var e=this,n=t.items;return Array.isArray(n)?'\n      <div class="chat-carousel">\n        '.concat(n.map((function(t){return e.renderCard(t)})).join(""),"\n      </div>\n    "):""},t.prototype.renderQuickReplies=function(t){var e=this,n=t.replies;return Array.isArray(n)?'\n      <div class="chat-quick-replies">\n        '.concat(n.map((function(t){return e.renderButton(P(P({},t),{style:"quick-reply"}))})).join(""),"\n      </div>\n    "):""},t.prototype.sanitizeHtml=function(t){return t.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/on\w+="[^"]*"/g,"").replace(/javascript:/gi,"").replace(/data:/gi,"").replace(/vbscript:/gi,"")},t.prototype.sanitizeText=function(t){return t?t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):""},t.prototype.sanitizeUrl=function(t){try{var e=new URL(t);return["http:","https:"].includes(e.protocol)?t:"#"}catch(t){return"#"}},t}(),O=function(){return O=Object.assign||function(t){for(var e,n=1,a=arguments.length;n<a;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},O.apply(this,arguments)},B=function(){function t(e,n){void 0===e&&(e={}),void 0===n&&(n={}),this.options=O(O({},t.defaultOptions),e);var a=Object.entries(n).filter((function(t){return"string"==typeof t[1]}));this.emojiMap=O(O({},H),Object.fromEntries(a)),this.textProcessor=new _(this.emojiMap),this.svgProcessor=new F,this.customRenderer=new j}return t.prototype.render=function(t){if(!(null==t?void 0:t.content))return"";try{var e=void 0;switch(t.type){case"html":e=this.options.enableHtml?this.sanitizeHtml(t.content):this.textProcessor.processText(t.content,this.options);break;case"svg":e=this.options.enableSvg?this.svgProcessor.processSvg(t.content):t.content;break;case"custom":e=this.customRenderer.renderCustom(t);break;default:return this.processTextWithSvg(t.content)}return e}catch(t){return console.error("Error rendering message:",t),'<div class="message-error">Error rendering message</div>'}},t.prototype.processTextWithSvg=function(t){for(var e=t.match(/```svg([\s\S]*?)```/g)||[],n=t.split(/```svg[\s\S]*?```/),a="",o=0;o<n.length;o++)if(n[o]&&(a+=this.textProcessor.processText(n[o],this.options)),e[o]){var i=e[o].replace(/```svg\s*|\s*```/g,"");a+=this.svgProcessor.processSvg(i)}return a},t.prototype.sanitizeHtml=function(t){return t.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"")},t.defaultOptions={enableMarkdown:!0,enableHtml:!1,enableEmoji:!0,enableLinks:!0,enableSvg:!0},t}(),U='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">\n  <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />\n</svg>\n',D='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">\n  <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15M20.25 3.75h-4.5m4.5 0v4.5m0-4.5L15 9m5.25 11.25h-4.5m4.5 0v-4.5m0 4.5L15 15" />\n</svg>\n',q=function(){function t(t,e,n,a,o){var i,r;this.element=null,this.resizeTimeout=null,this.cachedElements=new Map,this.eventListeners=new Map,this.config=t,this.theme=e,this.assets=n,this.containerId=a,this.boundToggleHandler=o.onToggle,this.boundSendHandler=o.onSend,this.boundInputKeyHandler=o.onInputKey,this.boundResizeHandler=this.debounceResize(o.onResize),this.boundExpandHandler=o.onExpand,this.boundPromptClickHandler=o.onPromptClick,this.boundAttachmentClickHandler=o.onAttachmentClick,this.boundFileSelectHandler=o.onFileSelect,this.boundAttachmentRemoveHandler=o.onAttachmentRemove,this.debouncedUpdateSendButton=(i=this.updateSendButtonState.bind(this),r=null,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];null!==r&&clearTimeout(r),r=window.setTimeout((function(){r=null,i.apply(void 0,t)}),100)})}return t.prototype.createAndMount=function(){return this.removeExistingWidget(),this.element=document.createElement("div"),this.element.className="am-chat-widget am-chat-widget--".concat(this.config.variant),this.element.setAttribute("data-container",this.containerId),this.element.innerHTML=this.generateTemplate(),this.applyInitialStyling(),this.mountToContainer(),this.attachEventListeners(),this.setupResponsiveBehavior(),this.element},t.prototype.updateUI=function(t){if(this.element){var e=this.element.querySelector(".am-chat-container"),n=this.element.querySelector(".am-chat-toggle");"corner"===this.config.variant?(e&&(e.style.display=t.isOpen?"flex":"none"),n&&(n.style.display=t.isOpen?"none":"flex"),this.updateResponsiveLayout()):(e&&(e.style.display="flex"),n&&(n.style.display="none")),this.updateSendButtonState()}},t.prototype.updateTheme=function(t){var e=this;this.element&&(Object.entries(t).forEach((function(t){var n=t[0],a=t[1];a&&e.element.style.setProperty("--chat-".concat(n),a)})),this.updateToggleButtonStyling(t),this.updateHeaderStyling(t),this.updateInputStyling(t))},t.prototype.getElement=function(t){var e;if(this.cachedElements.has(t)){var n=this.cachedElements.get(t);if(n.isConnected)return n;this.cachedElements.delete(t)}var a=null===(e=this.element)||void 0===e?void 0:e.querySelector(t);return a&&this.cachedElements.set(t,a),a},t.prototype.getRootElement=function(){return this.element},t.prototype.destroy=function(){this.removeEventListeners(),this.cleanupAllEventListeners(),this.resizeTimeout&&window.clearTimeout(this.resizeTimeout),this.removeExistingWidget(),this.cachedElements.clear(),this.eventListeners.clear(),this.element=null},t.prototype.generateTemplate=function(){var t="corner"===this.config.variant;return"\n      ".concat(t?this.generateToggleButton():"","\n      ").concat(this.generateMainContainer(),"\n    ")},t.prototype.generateToggleButton=function(){return'\n      <button class="am-chat-toggle" \n              style="background-color: '.concat(this.theme.toggleBackgroundColor,' !important;">\n        <div class="am-chat-toggle-content">\n          <div class="am-chat-logo" style="color: ').concat(this.theme.toggleIconColor,' !important;">\n            ').concat(this.assets.logo||'<?xml version="1.0" encoding="UTF-8"?>\n<svg width="49px" height="58px" viewBox="0 0 49 58" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    <title>Shape</title>\n    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n        <g id="agentman-logo-mark-v2" transform="translate(-9.845526, -7.576144)" fill="var(--color-primary, currentColor)" fill-rule="nonzero">\n            <path d="M26.1390614,54.166181 C25.309581,53.7081948 24.4468967,53.7064528 23.5734741,53.7549758 C21.9662658,53.8442778 20.3496257,54.0614167 18.7509242,53.8143325 C16.8156838,53.5152347 15.6085356,52.2151668 15.3495144,50.0308585 C15.3168607,49.7554755 15.2630162,49.4766529 15.278027,49.2026622 C15.3265341,48.317182 15.1496275,47.5702516 14.4246474,46.9371072 C13.9178903,46.4945451 14.0170407,45.7827926 14.131968,45.1623384 C14.183441,44.8844567 14.1394002,44.697384 13.9327549,44.5208016 C13.3825198,44.0506147 13.2950139,43.4351325 13.4075315,42.7660218 C13.487796,42.2887142 13.5875121,41.8146172 13.6644705,41.3368201 C13.7233122,40.9715246 13.5434683,40.7446583 13.2072409,40.6193645 C12.7688209,40.4560002 12.3248315,40.3041243 11.8975759,40.1149217 C10.6417409,39.5588152 9.78350399,37.8663547 10.8894276,36.316723 C11.8652176,34.9494275 12.733163,33.5036762 13.5406676,32.0232558 C14.1999427,30.8145848 14.4855745,29.5576676 14.448982,28.1806063 C14.389495,25.9420116 14.7978774,23.7598077 15.5416481,21.6546066 C16.5081906,18.9188488 17.9625471,16.4532573 20.0458137,14.424665 C21.9403894,12.5798106 24.1768478,11.2166221 26.6326388,10.2229443 C29.7466969,8.96290849 32.9944602,8.35421005 36.33857,8.5025413 C41.6745909,8.73923693 46.635166,10.1697453 50.8378497,13.6270721 C54.6692363,16.7789562 57.1116471,20.77468 57.7919984,25.7336688 C58.2183098,28.8409971 57.658128,31.8347398 56.4983773,34.7367708 C55.3367701,37.6434365 53.4945193,40.1166573 51.6231306,42.5776966 C50.40361,44.1814716 49.1575074,45.7826527 48.7488325,47.8225938 C48.2744495,50.19051 48.3810321,52.5352771 49.0997274,54.8555222 C49.6013856,56.4751029 50.3598999,57.9705278 51.1633134,59.4500835 C51.5586495,60.1781185 51.5582299,60.2138241 50.8735171,60.6387178 C46.861066,63.1286469 42.4810369,64.4809889 37.7890007,64.8965684 C36.5226134,65.0087332 35.2579459,65.015943 33.9936121,64.9849359 C31.6271297,64.926908 29.3033306,64.568994 27.0312492,63.883887 C26.5881816,63.7502901 26.514291,63.5698485 26.6660777,63.1360792 C27.5105913,60.7226665 27.6217675,58.2572277 27.0959623,55.761195 C26.9648385,55.1387381 26.7281174,54.5654209 26.1390614,54.166181 M28.0824303,24.2863313 C28.6058226,23.488303 29.1187246,22.6830904 29.6575761,21.8956414 C29.884967,21.5633527 29.9102839,21.2877885 29.7474852,20.8948016 C29.3309426,19.8893173 29.2248622,18.7812272 29.9190482,17.914083 C31.4196007,16.039652 34.1318663,16.1708648 35.2026582,18.277595 C35.5559753,18.9727345 35.5381575,19.6814735 35.4494214,20.4066665 C35.4221622,20.6294227 35.3981106,20.8007915 35.6025211,20.9561578 C36.3760813,21.5440948 37.1419103,22.1422457 37.9080669,22.7398626 C38.113021,22.8997269 38.3065247,22.911578 38.524185,22.7585736 C39.3260343,22.1949077 40.2231367,21.8955461 41.1994831,21.8627333 C41.6264748,21.8483837 41.7975894,21.6393479 41.8874573,21.2472319 C42.1390048,20.1497467 42.4170645,19.0582569 42.6930451,17.9665223 C42.7592873,17.7044812 42.6973302,17.520012 42.5097044,17.3143617 C41.7964006,16.5325459 41.4206719,15.6235098 41.6596945,14.5514178 C41.7473881,14.1580748 41.5469447,14.0556629 41.2473193,13.9886959 C40.0107152,13.7122988 38.7571103,13.5024491 37.4969124,13.437771 C35.01652,13.3104682 32.5851972,13.6081544 30.2441938,14.5037341 C28.1534918,15.3035616 26.267267,16.4358401 24.7621656,18.0918829 C22.7851955,20.2671281 21.4335878,22.7718425 21.0929036,25.753432 C20.8213893,28.1296673 21.1618097,30.3172468 22.8806869,32.1311513 C24.1675941,33.489209 25.6126491,34.5206236 27.5694934,34.6549582 C28.9407753,34.7490859 30.3116027,34.7365928 31.6794228,34.6930289 C33.462708,34.6362217 34.8845887,35.2797293 36.0109702,36.6431593 C37.1123941,37.9763769 37.6450276,39.4600081 37.412455,41.2170831 C37.3089083,41.9993631 37.3169732,42.8022679 37.5480866,43.5903016 C38.1453347,45.6267269 40.5813686,46.2820729 42.119321,44.819378 C43.0997299,43.8869388 44.1137973,42.9899572 45.1100564,42.0741184 C46.9666377,40.3673911 48.7085557,38.5581691 50.1653313,36.4875452 C50.4263393,36.1165531 50.4301222,35.9020336 49.9985464,35.6843606 C49.101355,35.2318548 48.6656848,34.453555 48.5628088,33.4774661 C48.5422602,33.2824714 48.471345,33.1566118 48.3037718,33.0641786 C47.3468041,32.5362944 46.390682,32.0068304 45.4375482,31.4720702 C45.2169823,31.3483151 45.0219623,31.3388959 44.8141248,31.5005501 C44.3425075,31.8673745 43.8085008,32.1247394 43.2370591,32.2808814 C42.7814125,32.4053835 42.6517764,32.6751271 42.6613959,33.1203372 C42.6924984,34.5597243 42.7061549,35.9997916 42.6996255,37.4394773 C42.6977753,37.8468807 42.821486,38.1254427 43.169132,38.3458494 C43.4619355,38.5314854 43.7027383,38.7920991 43.8544551,39.1149623 C44.3617463,40.1945662 44.3215458,41.2492791 43.5907515,42.203335 C42.8874675,43.1214881 41.9044836,43.3821145 40.7973313,43.1552481 C39.7189736,42.9342818 38.8666685,42.0024212 38.6834803,40.9001071 C38.5054739,39.8290419 39.0098913,38.7575952 39.9987244,38.1873806 C40.2908921,38.0189044 40.3424541,37.7965776 40.3486593,37.5004363 C40.3806964,35.9722494 40.2864797,34.4472289 40.2469341,32.9208922 C40.242509,32.7500319 40.2703436,32.5182222 40.0841164,32.4575845 C39.3350307,32.2136855 38.720483,31.6291181 37.8698595,31.6362134 C35.6827377,31.6544604 33.4942556,31.608827 31.3087169,31.6718522 C30.3790275,31.6986568 29.5604157,31.5060273 28.8132087,30.9941554 C28.4857583,30.7698353 28.2310383,30.7676736 27.8698087,30.94678 C26.9078533,31.4237475 25.0910973,31.3480098 24.2817997,30.2013468 C23.6880358,29.3600631 23.6951311,28.4732444 23.8627807,27.5647616 C24.0540623,26.5282098 25.0625761,25.6539226 26.1185828,25.6598194 C26.9653662,25.6645496 27.5446152,25.3952002 27.8729939,24.6117409 C27.9126064,24.5172317 27.9840366,24.4360582 28.0824303,24.2863313 M53.0363043,28.9167316 C53.1133675,27.2434751 53.0296985,25.5797616 52.5288923,23.9731669 C51.6462095,21.1414758 49.9980123,18.8278841 47.6839025,16.9759377 C47.3438732,16.7038162 47.1229767,16.7269937 46.8674492,17.05803 C46.5044299,17.5283471 46.0074512,17.8155303 45.4387052,17.9541563 C45.1496593,18.0246107 45.0012866,18.1508294 44.9304477,18.4490657 C44.6462273,19.6456122 44.3493167,20.8395743 44.0281446,22.0266572 C43.930641,22.3870316 44.1533048,22.4861534 44.3748688,22.6208917 C45.2708268,23.1657321 45.982821,23.8845801 46.4279325,24.841853 C47.0497155,26.1790664 47.0682931,27.5541281 46.6273903,28.9430689 C46.5360983,29.2306781 46.5367786,29.4309115 46.8385593,29.5884521 C47.5766078,29.9737429 48.3055965,30.3765559 49.0345597,30.7789683 C49.1945671,30.8673008 49.3319026,30.932567 49.5124014,30.813132 C50.3675485,30.2472598 51.3034526,30.2283804 52.2657926,30.4343612 C52.576201,30.5008006 52.7797023,30.4114 52.8409218,30.086178 C52.9081686,29.728903 52.9669149,29.3700258 53.0363043,28.9167316 M31.6579842,22.9406651 C30.9863622,23.9926409 30.3296908,25.0546209 29.6359372,26.0917957 C29.3487095,26.5212035 29.171981,26.9090883 29.414227,27.4301472 C29.532721,27.6850167 29.5403313,28.0035344 29.5493182,28.2947453 C29.5689416,28.9308714 29.9306893,29.3850239 30.5657538,29.3921796 C32.2997498,29.4117172 34.0343181,29.4008866 35.7683968,29.380211 C36.2601145,29.3743491 36.461505,29.1000025 36.3570872,28.620692 C36.0994458,27.4380373 36.1229443,26.2777432 36.5936525,25.14961 C36.7065802,24.8789477 36.6495219,24.6928128 36.4246138,24.5205951 C35.9430909,24.1518822 35.4541516,23.7904938 34.9964165,23.3936158 C34.2932566,22.7839478 33.5638388,22.3282217 32.5795165,22.6860785 C32.456696,22.7307295 32.3041399,22.6968455 32.1654788,22.6938541 C31.9850627,22.6899568 31.818192,22.7141419 31.6579842,22.9406651 M39.3199753,26.0429358 C39.1030144,26.4614589 38.8638139,26.9045806 38.9643374,27.3742906 C39.3727581,29.2827582 40.5836256,30.0033482 42.4534122,29.5182458 C43.4354806,29.2634558 44.1303658,28.1904291 44.0913733,27.2244207 C44.0403771,25.961527 43.3174601,25.0682457 42.0976408,24.760851 C41.0871275,24.5062072 39.917446,25.024294 39.3199753,26.0429358 Z" id="Shape"></path>\n        </g>\n    </g>\n</svg>','\n          </div>\n          <span class="am-chat-toggle-text" \n                style="color: ').concat(this.theme.toggleTextColor,' !important;">\n            ').concat(this.config.toggleText||"Ask AI","\n          </span>\n        </div>\n      </button>\n    ")},t.prototype.generateMainContainer=function(){return'\n      <div class="am-chat-container">\n        '.concat(this.generateHeader(),"\n        ").concat(this.generateMessagesArea(),"\n        ").concat(this.generateInputArea(),"\n        ").concat(this.generateBranding(),"\n      </div>\n    ")},t.prototype.generateHeader=function(){return'\n      <div class="am-chat-header">\n        <div class="am-chat-header-content">\n          <div class="am-chat-logo-title">\n            <span>'.concat(this.config.title||"AI Assistant",'</span>\n          </div>\n          <div class="am-chat-header-actions">\n            <button class="am-chat-expand am-chat-header-button desktop-only" \n                    title="Expand">\n              ').concat(D,'\n            </button>\n            <button class="am-chat-minimize am-chat-header-button" \n                    title="Close">\n              ').concat(U,"\n            </button>\n          </div>\n        </div>\n      </div>\n    ")},t.prototype.generateMessagesArea=function(){return'\n      <div class="am-chat-messages" \n           style="background-color: '.concat(this.theme.backgroundColor,"; \n                  color: ").concat(this.theme.textColor,';">\n      </div>\n    ')},t.prototype.generateMessagePrompts=function(){var t=this,e=this.config.messagePrompts;if(!e||!e.show)return"";var n=(e.prompts||[]).filter((function(t){return t&&t.trim().length>0}));return 0===n.length?"":'\n      <div class="am-chat-input-prompts">\n        '.concat(n.map((function(e){return'\n          <button class="am-chat-input-prompt-btn" \n                  data-prompt="'.concat(t.escapeHtml(e||""),'"\n                  title="').concat(t.escapeHtml(e||""),'">\n            ').concat(t.escapeHtml(e||""),"\n          </button>\n        ")})).join(""),"\n      </div>\n    ")},t.prototype.generateInputArea=function(){var t=this.config.enableAttachments;return"\n      ".concat(this.generateMessagePrompts(),'\n      <div class="am-chat-input-wrapper">\n        ').concat(t?this.generateAttachmentPreview():"",'\n        <div class="am-chat-input-container">\n          ').concat(t?this.generateAttachmentButton():"",'\n          <textarea class="am-chat-input" \n                    placeholder="').concat(this.config.placeholder||"Type your message...",'"\n                    rows="1"></textarea>\n          <button class="am-chat-send" \n                  style="background-color: ').concat(this.theme.buttonColor,"; \n                         color: ").concat(this.theme.buttonTextColor,';"\n                  disabled>\n            ').concat('<svg enable-background="new 0 0 32 32" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">\n  <g id="Arrow_Up_Circle">\n    <path d="M16,0C7.163,0,0,7.164,0,16c0,8.837,7.163,16,16,16c8.836,0,16-7.163,16-16C32,7.164,24.836,0,16,0z M16,30 C8.268,30,2,23.732,2,16S8.268,2,16,2c7.732,0,14,6.268,14,14S23.732,30,16,30z" fill="var(--chat-header-text-color, currentColor)"/>\n    <path d="M16.715,6.293C16.527,6.107,16.264,6,16,6c-0.263,0-0.526,0.108-0.714,0.293l-6.999,6.899 c-0.395,0.391-0.394,1.024,0,1.414c0.395,0.391,1.034,0.391,1.429,0l5.275-5.2V25c0,0.552,0.452,1,1.01,1 c0.558,0,1.01-0.448,1.01-1V9.407l5.275,5.2c0.394,0.39,1.034,0.39,1.428,0c0.394-0.391,0.394-1.024,0-1.414L16.715,6.293z" fill="var(--chat-header-text-color, currentColor)"/>\n  </g>\n</svg>',"\n          </button>\n        </div>\n      </div>\n    ")},t.prototype.generateAttachmentButton=function(){return'\n      <button class="chat-attachment-button" type="button" title="Attach files">\n        '.concat('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n  <path d="m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66L9.64 16.2a2 2 0 0 1-2.83-2.83l8.49-8.48"/>\n</svg>','\n      </button>\n      <input type="file" class="chat-file-input" multiple>\n    ')},t.prototype.generateAttachmentPreview=function(){return'\n      <div class="chat-attachments-preview" style="display: none;"></div>\n    '},t.prototype.generateBranding=function(){return this.config.hideBranding,'\n      <div class="am-chat-branding">\n        Powered by Agentman.ai\n      </div>\n    '},t.prototype.applyInitialStyling=function(){if(this.element){if(this.config.initialHeight||this.config.initialWidth){var t=this.element.querySelector(".am-chat-container");t&&(this.config.initialHeight&&(t.style.height=this.config.initialHeight),this.config.initialWidth&&(t.style.width=this.config.initialWidth))}this.updateTheme(this.theme)}},t.prototype.mountToContainer=function(){if(this.element)if("inline"===this.config.variant){var t=document.getElementById(this.containerId);if(!t)return void console.error('Container with id "'.concat(this.containerId,'" not found'));t.innerHTML="",t.appendChild(this.element)}else document.body.appendChild(this.element)},t.prototype.attachEventListeners=function(){var t=this;if(this.element){var e=this.element.querySelector(".am-chat-toggle");e&&e.addEventListener("click",this.boundToggleHandler);var n=this.element.querySelector(".am-chat-minimize");n&&n.addEventListener("click",this.boundToggleHandler);var a=this.element.querySelector(".am-chat-expand");a&&this.boundExpandHandler&&a.addEventListener("click",this.boundExpandHandler);var o=this.element.querySelector(".am-chat-send");o&&o.addEventListener("click",this.boundSendHandler);var i=this.element.querySelector(".am-chat-input");i&&(i.addEventListener("keydown",this.boundInputKeyHandler),i.addEventListener("input",this.handleInputChange.bind(this))),this.element.querySelectorAll(".am-chat-input-prompt-btn").forEach((function(e){e.addEventListener("click",t.handlePromptClick.bind(t))})),this.config.enableAttachments&&this.attachAttachmentListeners(),window.addEventListener("resize",this.boundResizeHandler)}},t.prototype.removeEventListeners=function(){var t=this;if(this.element){var e=this.element.querySelector(".am-chat-toggle");e&&e.removeEventListener("click",this.boundToggleHandler);var n=this.element.querySelector(".am-chat-minimize");n&&n.removeEventListener("click",this.boundToggleHandler);var a=this.element.querySelector(".am-chat-expand");a&&this.boundExpandHandler&&a.removeEventListener("click",this.boundExpandHandler);var o=this.element.querySelector(".am-chat-send");o&&o.removeEventListener("click",this.boundSendHandler);var i=this.element.querySelector(".am-chat-input");i&&(i.removeEventListener("keydown",this.boundInputKeyHandler),i.removeEventListener("input",this.handleInputChange.bind(this))),this.element.querySelectorAll(".am-chat-input-prompt-btn").forEach((function(e){e.removeEventListener("click",t.handlePromptClick.bind(t))})),window.removeEventListener("resize",this.boundResizeHandler)}},t.prototype.handleInputChange=function(t){var e=t.target;e.style.height="auto";var n=Math.max(32,Math.min(e.scrollHeight,120));e.style.height="".concat(n,"px"),this.debouncedUpdateSendButton()},t.prototype.updateSendButtonState=function(){var t,e,n,a=null===(t=this.element)||void 0===t?void 0:t.querySelector(".am-chat-input"),o=null===(e=this.element)||void 0===e?void 0:e.querySelector(".am-chat-send");if(a&&o){var i=a.value.trim().length>0,r=null===(n=this.element)||void 0===n?void 0:n.querySelector(".chat-attachments-preview"),s=r&&"none"!==r.style.display&&r.children.length>0;o.disabled=!(i||s)}},t.prototype.setupResponsiveBehavior=function(){this.updateResponsiveLayout()},t.prototype.updateResponsiveLayout=function(){if("corner"===this.config.variant&&this.element){var t=this.element.querySelector(".am-chat-container");t&&(window.innerWidth<=480?(t.style.width="100%",t.style.height="100%",t.style.borderRadius="0",t.style.bottom="0",t.style.right="0",t.style.position="fixed"):(t.style.width=this.config.initialWidth||"400px",t.style.height=this.config.initialHeight||"600px",t.style.borderRadius="12px",t.style.bottom="20px",t.style.right="20px",t.style.position="fixed"))}},t.prototype.updateToggleButtonStyling=function(t){var e,n=null===(e=this.element)||void 0===e?void 0:e.querySelector(".am-chat-toggle");if(n){t.toggleBackgroundColor&&(n.style.backgroundColor=t.toggleBackgroundColor);var a=n.querySelector(".am-chat-toggle-text");a&&t.toggleTextColor&&(a.style.color=t.toggleTextColor);var o=n.querySelector(".am-chat-logo");o&&t.toggleIconColor&&(o.style.color=t.toggleIconColor)}},t.prototype.updateHeaderStyling=function(t){var e;null===(e=this.element)||void 0===e||e.querySelector(".am-chat-header")},t.prototype.updateInputStyling=function(t){var e,n=null===(e=this.element)||void 0===e?void 0:e.querySelector(".am-chat-send");n&&(t.buttonColor&&(n.style.backgroundColor=t.buttonColor),t.buttonTextColor&&(n.style.color=t.buttonTextColor))},t.prototype.removeExistingWidget=function(){var t=document.querySelector('.am-chat-widget[data-container="'.concat(this.containerId,'"]'));t&&t.remove()},t.prototype.handlePromptClick=function(t){var e=t.target.getAttribute("data-prompt");e&&this.boundPromptClickHandler&&this.boundPromptClickHandler(e)},t.prototype.hideMessagePrompts=function(){},t.prototype.showMessagePrompts=function(){},t.prototype.showFloatingPrompts=function(){var t;if("corner"===this.config.variant&&!document.querySelector(".am-chat-floating-prompts-container")){var e=document.createElement("div");e.className="am-chat-floating-prompts-container",e.innerHTML=this.generateFloatingPrompts();var n=null===(t=this.element)||void 0===t?void 0:t.querySelector(".am-chat-toggle");n&&n.parentElement&&(n.parentElement.insertBefore(e,n),this.attachFloatingPromptListeners(e))}},t.prototype.hideFloatingPrompts=function(){var t=document.querySelector(".am-chat-floating-prompts-container");t&&t.remove()},t.prototype.generateFloatingPrompts=function(){var t=this,e=this.config.messagePrompts;if(!e||!e.show)return"";var n=e.welcome_message||"How can I help you today?",a=(e.prompts||[]).filter((function(t){return t&&t.trim().length>0}));return 0===a.length?"":'\n      <div class="am-chat-floating-welcome-message">\n        <div class="am-chat-floating-welcome-header">\n          <div class="am-chat-floating-welcome-avatar">\n            '.concat('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="var(--color-primary, currentColor)">\n  <path d="M20 2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h4l4 4 4-4h4c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"/>\n</svg>','\n          </div>\n          <div class="am-chat-floating-welcome-text">').concat(n,'</div>\n        </div>\n      </div>\n      <div class="am-chat-floating-message-prompts">\n        ').concat(a.map((function(e){return'\n          <button class="am-chat-floating-message-prompt" \n                  data-prompt="'.concat(t.escapeHtml(e||""),'"\n                  title="').concat(t.escapeHtml(e||""),'">\n            ').concat(t.escapeHtml(e||""),"\n          </button>\n        ")})).join(""),"\n      </div>\n    ")},t.prototype.attachFloatingPromptListeners=function(t){var e=this;t.querySelectorAll(".am-chat-floating-message-prompt").forEach((function(t){t.addEventListener("click",(function(t){var n=t.target.getAttribute("data-prompt");n&&e.boundPromptClickHandler&&(t.target.style.background="var(--chat-button-color, #2563eb)",t.target.style.color="var(--chat-button-text-color, #ffffff)",setTimeout((function(){e.boundPromptClickHandler(n),e.hideFloatingPrompts()}),200))}))}))},t.prototype.attachAttachmentListeners=function(){var t=this;if(this.element){var e=this.element.querySelector(".chat-attachment-button");e&&this.boundAttachmentClickHandler&&e.addEventListener("click",this.boundAttachmentClickHandler);var n=this.element.querySelector(".chat-file-input");n&&this.boundFileSelectHandler&&n.addEventListener("change",(function(e){var n=e.target.files;n&&t.boundFileSelectHandler&&t.boundFileSelectHandler(n)}))}},t.prototype.updateAttachmentPreview=function(t){var e=this;if(this.config.enableAttachments&&this.element){var n=this.element.querySelector(".chat-attachments-preview"),a=this.element.querySelector(".am-chat-input-wrapper");if(n){if(0===t.length)return n.style.display="none",n.innerHTML="",void(a&&a.classList.remove("has-attachments"));n.style.display="flex",a&&a.classList.add("has-attachments"),n.innerHTML=t.map((function(t){var n="error"===t.upload_status?"error":"",a="uploading"===t.upload_status?'<div class="chat-attachment-progress"><div class="chat-attachment-progress-bar" style="width: '.concat(t.upload_progress||0,'%"></div></div>'):"",o="image"===t.file_type&&t.url?'<img src="'.concat(t.url,'" alt="').concat(e.escapeHtml(t.filename),'" class="chat-attachment-thumbnail" />'):'<div class="chat-attachment-icon">'.concat(e.getFileTypeIcon(t.filename),"</div>");return'\n        <div class="chat-attachment-item '.concat(n,'">\n          ').concat(o,'\n          <div class="chat-attachment-info">\n            <div class="chat-attachment-name">').concat(e.escapeHtml(t.filename),'</div>\n          </div>\n          <button class="chat-attachment-remove" data-id="').concat(t.file_id,'" title="Remove attachment">√ó</button>\n          ').concat(a,"\n        </div>\n      ")})).join(""),setTimeout((function(){n.scrollWidth>n.clientWidth?n.classList.add("has-overflow"):n.classList.remove("has-overflow")}),100),n.querySelectorAll(".chat-attachment-remove").forEach((function(t){e.addTrackedEventListener(t,"click",(function(t){var n=t.target.getAttribute("data-id");n&&e.boundAttachmentRemoveHandler&&e.boundAttachmentRemoveHandler(n)}))})),this.debouncedUpdateSendButton()}}},t.prototype.formatFileSize=function(t){if(0===t)return"0 Bytes";var e=Math.floor(Math.log(t)/Math.log(1024));return parseFloat((t/Math.pow(1024,e)).toFixed(2))+" "+["Bytes","KB","MB","GB"][e]},t.prototype.getFileTypeIcon=function(t){var e=t.toLowerCase().split(".").pop()||"",a=n(144).e;return["jpg","jpeg","png","gif","webp","svg"].includes(e)?a.image:["mp3","wav","ogg","flac","m4a"].includes(e)?a.audio:["mp4","webm","mov","avi","mkv"].includes(e)?a.video:["pdf","doc","docx","txt","rtf"].includes(e)?a.document:a.file},t.prototype.clearFileInput=function(){var t,e=null===(t=this.element)||void 0===t?void 0:t.querySelector(".chat-file-input");e&&(e.value="")},t.prototype.escapeHtml=function(t){var e=document.createElement("div");return e.textContent=t,e.innerHTML},t.prototype.debounceResize=function(t){var e=this;return function(){e.resizeTimeout&&window.clearTimeout(e.resizeTimeout),e.resizeTimeout=window.setTimeout((function(){t(),e.updateResponsiveLayout()}),100)}},t.prototype.addTrackedEventListener=function(t,e,n){t.addEventListener(e,n),this.eventListeners.has(t)||this.eventListeners.set(t,[]),this.eventListeners.get(t).push({event:e,handler:n})},t.prototype.cleanupAllEventListeners=function(){this.eventListeners.forEach((function(t,e){t.forEach((function(t){var n=t.event,a=t.handler;e.removeEventListener(n,a)}))})),this.eventListeners.clear()},t}(),R=function(){function t(t,e,n){this.element=null,this.isListViewOpen=!1,this.config=t,this.theme=e,this.boundNewConversationHandler=n.onNewConversation,this.boundSwitchConversationHandler=n.onSwitchConversation,this.boundDeleteConversationHandler=n.onDeleteConversation,this.boundToggleListViewHandler=n.onToggleListView}return t.prototype.createConversationListView=function(){return this.element=document.createElement("div"),this.element.className="am-conversation-list-view",this.element.style.display="none",this.element.innerHTML=this.generateConversationListTemplate(),this.attachEventListeners(),this.element},t.prototype.updateConversationList=function(t,e){var n=this;if(this.element){var a=this.element.querySelector(".am-conversation-list");if(a)if(0!==t.length)a.innerHTML=t.map((function(t){return'\n      <div class="am-conversation-item '.concat(t.id===e?"active":"",'" \n           data-conversation-id="').concat(t.id,'">\n        <div class="am-conversation-info">\n          <div class="am-conversation-title">').concat(n.escapeHtml(t.title),'</div>\n          <div class="am-conversation-date">').concat(n.formatDate(t.lastUpdated),'</div>\n        </div>\n        <div class="am-conversation-actions">\n          <button class="am-conversation-delete" \n                  data-conversation-id="').concat(t.id,'"\n                  title="Delete conversation">\n            ').concat(U,"\n          </button>\n        </div>\n      </div>\n    ")})).join(""),this.attachConversationListeners();else{a.innerHTML='\n        <div class="am-conversation-empty">\n          <p>No conversations yet</p>\n          <button class="am-conversation-new-button">Start new conversation</button>\n        </div>\n      ';var o=a.querySelector(".am-conversation-new-button");o&&o.addEventListener("click",(function(){n.boundNewConversationHandler&&n.boundNewConversationHandler()}))}}},t.prototype.toggleListView=function(){var t=this;this.element&&(this.isListViewOpen=!this.isListViewOpen,this.isListViewOpen?(this.element.style.display="flex",this.element.classList.remove("closing"),this.element.classList.add("opening")):(this.element.classList.remove("opening"),this.element.classList.add("closing"),setTimeout((function(){t.isListViewOpen||(t.element.style.display="none",t.element.classList.remove("closing"))}),300)),this.boundToggleListViewHandler&&this.boundToggleListViewHandler())},t.prototype.isListViewActive=function(){return this.isListViewOpen},t.prototype.addConversationButton=function(t,e){var n=this;if(void 0===e&&(e=!1),e){var a=document.createElement("button");a.className="am-conversation-toggle am-chat-header-button am-header-button-with-text",a.title="Conversation History",a.innerHTML="\n      ".concat('<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">\n  <path stroke-linecap="round" stroke-linejoin="round" d="M20.25 8.511c.884.284 1.5 1.128 1.5 2.097v4.286c0 1.136-.847 2.1-1.98 2.193-.34.027-.68.052-1.02.072v3.091l-3-3c-1.354 0-2.694-.055-4.02-.163a2.115 2.115 0 0 1-.825-.242m9.345-8.334a2.126 2.126 0 0 0-.476-.095 48.64 48.64 0 0 0-8.048 0c-1.131.094-1.976 1.057-1.976 2.192v4.286c0 .837.46 1.58 1.155 1.951m9.345-8.334V6.637c0-1.621-1.152-3.026-2.76-3.235A48.455 48.455 0 0 0 11.25 3c-2.115 0-4.198.137-6.24.402-1.608.209-2.76 1.614-2.76 3.235v6.226c0 1.621 1.152 3.026 2.76 3.235.577.075 1.157.14 1.74.194V21l4.155-4.155" />\n</svg>','\n      <span class="am-button-label">Chats</span>\n      <span class="am-conversation-indicator"></span>\n    '),a.addEventListener("click",(function(){n.toggleListView()}));var o=t.querySelector(".am-chat-header-actions"),i=null==o?void 0:o.querySelector(".am-chat-header-button");o&&i?o.insertBefore(a,i):o&&o.appendChild(a)}},t.prototype.addNewConversationButton=function(t){var e=this,n=document.createElement("button");n.className="am-conversation-new-header am-chat-header-button am-header-button-with-text",n.title="New conversation",n.innerHTML="\n      ".concat('<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">\n  <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />\n</svg>','\n      <span class="am-button-label">New</span>\n    '),n.addEventListener("click",(function(){e.boundNewConversationHandler&&e.boundNewConversationHandler()}));var a=t.querySelector(".am-chat-header-actions"),o=null==a?void 0:a.querySelector(".am-chat-expand");a&&o?a.insertBefore(n,o):a&&a.appendChild(n)},t.prototype.addHeaderDivider=function(t){var e=document.createElement("div");e.className="am-header-divider";var n=t.querySelector(".am-chat-header-actions"),a=null==n?void 0:n.querySelector(".am-chat-expand");n&&a&&n.insertBefore(e,a)},t.prototype.addBackButton=function(t){var e=this,n=document.createElement("button");n.className="am-conversation-back am-chat-header-button",n.title="Back to chat",n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="var(--chat-header-text-color, currentColor)">\n  <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>\n</svg>',n.style.display=this.isListViewOpen?"block":"none",n.addEventListener("click",(function(){e.toggleListView()}));var a=t.querySelector(".am-chat-header-content");a&&a.insertBefore(n,a.firstChild)},t.prototype.updateHeaderButtons=function(t){var e=t.querySelector(".am-conversation-toggle"),n=t.querySelector(".am-conversation-back");t.querySelector(".am-conversation-new-header"),e&&(e.style.display=this.isListViewOpen?"none":"block"),n&&(n.style.display=this.isListViewOpen?"block":"none")},t.prototype.destroy=function(){this.removeEventListeners(),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null},t.prototype.generateConversationListTemplate=function(){return'\n      <div class="am-conversation-list-container">\n        <div class="am-conversation-list">\n          \x3c!-- Conversation list will be populated here --\x3e\n        </div>\n      </div>\n    '},t.prototype.attachEventListeners=function(){},t.prototype.attachConversationListeners=function(){var t=this;this.element&&(this.element.querySelectorAll(".am-conversation-item").forEach((function(e){e.addEventListener("click",(function(n){if(!n.target.closest(".am-conversation-delete")){var a=e.getAttribute("data-conversation-id");a&&t.boundSwitchConversationHandler&&t.boundSwitchConversationHandler(a)}}))})),this.element.querySelectorAll(".am-conversation-delete").forEach((function(e){e.addEventListener("click",(function(n){n.stopPropagation();var a=e.getAttribute("data-conversation-id");a&&t.boundDeleteConversationHandler&&confirm("Are you sure you want to delete this conversation?")&&t.boundDeleteConversationHandler(a)}))})))},t.prototype.removeEventListeners=function(){},t.prototype.formatDate=function(t){var e=new Date(t),n=(new Date).getTime()-e.getTime(),a=Math.floor(n/864e5);return 0===a?e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):1===a?"Yesterday":a<7?"".concat(a," days ago"):e.toLocaleDateString()},t.prototype.escapeHtml=function(t){var e=document.createElement("div");return e.textContent=t,e.innerHTML},t}(),N=function(){return N=Object.assign||function(t){for(var e,n=1,a=arguments.length;n<a;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},N.apply(this,arguments)},V=function(t,e,n,a){return new(n||(n=Promise))((function(o,i){function r(t){try{c(a.next(t))}catch(t){i(t)}}function s(t){try{c(a.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,s)}c((a=a.apply(t,e||[])).next())}))},W=function(t,e){var n,a,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},r=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return r.next=s(0),r.throw=s(1),r.return=s(2),"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,s[0]&&(i=0)),i;)try{if(n=1,a&&(o=2&s[0]?a.return:s[0]?a.throw||((o=a.return)&&o.call(a),0):a.next)&&!(o=o.call(a,s[1])).done)return o;switch(a=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,a=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=e.call(t,i)}catch(t){s=[6,t],a=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},K=function(){function t(){}return t.generateDeviceId=function(){var t=localStorage.getItem("am_device_id");if(t)return t;var e="dev_".concat(Date.now(),"_").concat(Math.random().toString(36).substring(2,9));return localStorage.setItem("am_device_id",e),e},t.generateSessionId=function(){var t=sessionStorage.getItem("am_session_id");if(t)return t;var e="sess_".concat(Date.now(),"_").concat(Math.random().toString(36).substring(2,9));return sessionStorage.setItem("am_session_id",e),e},t.detectBrowserDevice=function(t){var e=t.toLowerCase();return/mobile|android|iphone|ipad|tablet/.test(e)?/android/.test(e)?"Android Mobile":/iphone/.test(e)?"iPhone":/ipad/.test(e)?"iPad":"Mobile Device":/chrome/.test(e)&&!/edg/.test(e)?"Chrome Desktop":/safari/.test(e)&&!/chrome/.test(e)?"Safari Desktop":/firefox/.test(e)?"Firefox Desktop":/edg/.test(e)?"Edge Desktop":"Unknown Browser"},t.getTimezone=function(){try{return Intl.DateTimeFormat().resolvedOptions().timeZone}catch(a){var t=(new Date).getTimezoneOffset(),e=Math.floor(Math.abs(t)/60),n=Math.abs(t)%60;return"UTC".concat(t<=0?"+":"-").concat(e.toString().padStart(2,"0"),":").concat(n.toString().padStart(2,"0"))}},t.fetchIPAndGeoLocation=function(){return V(this,void 0,void 0,(function(){var t,e,n,a,o,i,r,s,c;return W(this,(function(l){switch(l.label){case 0:t=1024,e=2,n=0,a=["https://api.ipify.org?format=json"],l.label=1;case 1:if(!(n<a.length))return[3,6];o=a[n],i=function(n){var a,i,s,c,l;return W(this,(function(d){switch(d.label){case 0:return d.trys.push([0,3,,7]),[4,fetch(o,{method:"GET",headers:{Accept:"application/json","Cache-Control":"no-cache"},signal:AbortSignal.timeout(3e3),mode:"cors",credentials:"omit",referrerPolicy:"no-referrer"})];case 1:if(!(a=d.sent()).ok)throw new Error("HTTP ".concat(a.status,": ").concat(a.statusText));if((i=a.headers.get("content-length"))&&parseInt(i)>t)throw new Error("Response too large");return[4,a.text()];case 2:if((s=d.sent()).length>t)throw new Error("Response too large");return c=r.parseAndValidateIPResponse(s),[2,{value:r.extractIPData(c)}];case 3:return l=d.sent(),console.warn("IP service attempt ".concat(n+1," failed:"),l),n!==e-1?[3,4]:(console.warn("All retries failed for ".concat(o)),[3,6]);case 4:return[4,new Promise((function(t){return setTimeout(t,1e3*Math.pow(2,n))}))];case 5:d.sent(),d.label=6;case 6:return[3,7];case 7:return[2]}}))},r=this,s=0,l.label=2;case 2:return s<e?[5,i(s)]:[3,5];case 3:if("object"==typeof(c=l.sent()))return[2,c.value];l.label=4;case 4:return s++,[3,2];case 5:return n++,[3,1];case 6:return[2,{}]}}))}))},t.parseAndValidateIPResponse=function(t){try{var e=JSON.parse(t);if("object"!=typeof e||null===e)throw new Error("Invalid response format");return e}catch(t){throw new Error("Invalid JSON response: ".concat(t))}},t.extractIPData=function(t){var e={},n=t.ip||t.query||t.ipAddress;if("string"==typeof n&&this.isValidIP(n)&&(e.ip_address=n),t.city||t.country){var a=[];t.city&&"string"==typeof t.city&&a.push(this.sanitizeString(t.city)),(t.region||t.region_name)&&"string"==typeof(t.region||t.region_name)&&a.push(this.sanitizeString(t.region||t.region_name)),(t.country||t.country_name)&&"string"==typeof(t.country||t.country_name)&&a.push(this.sanitizeString(t.country||t.country_name)),a.length>0&&(e.geo_location=a.join(", "))}return e},t.isValidIP=function(t){return/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(t)||/^(?:[0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}$/.test(t)},t.sanitizeString=function(t){return t.replace(/[<>"'&]/g,"").substring(0,100).trim()},t.collect=function(t){var e,n={};try{return n.user_agent=navigator.userAgent,n.browser_language=navigator.language||(null===(e=navigator.languages)||void 0===e?void 0:e[0]),n.browser_device=this.detectBrowserDevice(navigator.userAgent),n.browser_timezone=this.getTimezone(),n.device_id=this.generateDeviceId(),n.session_id=this.generateSessionId(),n.page_url=this.sanitizeURL(window.location.href),n.referer_url=document.referrer?this.sanitizeURL(document.referrer):void 0,t&&Object.assign(n,t),Object.keys(n).forEach((function(t){void 0===n[t]&&delete n[t]})),n}catch(e){return console.error("Error collecting client metadata:",e),t||{}}},t.sanitizeURL=function(t){try{var e=new URL(t);return["http:","https:"].includes(e.protocol)?(e.hash="",e.toString().substring(0,500)):""}catch(t){return""}},t.collectWithIP=function(t){return V(this,void 0,void 0,(function(){var e,n;return W(this,(function(a){switch(a.label){case 0:return(e=this.collect(t)).ip_address||e.geo_location?[3,2]:[4,this.fetchIPAndGeoLocation()];case 1:n=a.sent(),!e.ip_address&&n.ip_address&&(e.ip_address=n.ip_address),!e.geo_location&&n.geo_location&&(e.geo_location=n.geo_location),a.label=2;case 2:return[2,e]}}))}))},t.mergeWithCustomTags=function(t,e){return e&&0!==Object.keys(e).length?N(N({},t),{custom_tags:N(N({},t.custom_tags||{}),e)}):t},t}(),J=function(){function t(){}return t.validateAgentMetadata=function(t){if(!t||"object"!=typeof t)return null;var e={};return t.supported_mime_types&&Array.isArray(t.supported_mime_types)&&(e.supported_mime_types=t.supported_mime_types.filter((function(t){return"string"==typeof t&&t.length>0}))),"boolean"==typeof t.supports_attachments&&(e.supports_attachments=t.supports_attachments),["model_name","model_version"].forEach((function(n){t[n]&&"string"==typeof t[n]&&(e[n]=t[n])})),["max_file_size","max_attachments"].forEach((function(n){t[n]&&"number"==typeof t[n]&&t[n]>0&&(e[n]=t[n])})),t.capabilities&&Array.isArray(t.capabilities)&&(e.capabilities=t.capabilities.filter((function(t){return"string"==typeof t&&t.length>0}))),e},t.validateClientMetadata=function(t){if(!t||"object"!=typeof t)return null;var e={};return void 0!==t.user_id&&("string"!=typeof t.user_id&&"number"!=typeof t.user_id||(e.user_id=t.user_id)),t.user_email_address&&"string"==typeof t.user_email_address&&this.isValidEmail(t.user_email_address)&&(e.user_email_address=t.user_email_address),["device_id","browser_language","browser_device","browser_timezone","ip_address","session_id","user_agent","referer_url","page_url","geo_location"].forEach((function(n){t[n]&&"string"==typeof t[n]&&(e[n]=t[n])})),"boolean"==typeof t.is_authenticated&&(e.is_authenticated=t.is_authenticated),t.custom_tags&&"object"==typeof t.custom_tags&&(e.custom_tags=this.sanitizeCustomTags(t.custom_tags)),e},t.isValidEmail=function(t){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)&&t.length<=254},t.sanitizeCustomTags=function(t){var e={};return Object.keys(t).forEach((function(n){var a=n.substring(0,50).replace(/[<>\"'&]/g,"");if(0!==a.length){var o=t[n];"string"==typeof o?e[a]=o.substring(0,200):"number"!=typeof o&&"boolean"!=typeof o||(e[a]=o)}})),e},t.checkStorageQuota=function(t){try{var e="__storage_test__";return localStorage.setItem(e,t),localStorage.removeItem(e),!0}catch(t){return console.warn("LocalStorage quota exceeded or unavailable:",t),!1}},t.getStorageStats=function(){try{var t=0;for(var e in localStorage)localStorage.hasOwnProperty(e)&&(t+=localStorage[e].length+e.length);return{used:Math.round(t/1024),available:!0}}catch(t){return{used:0,available:!1}}},t.sanitizeUserInput=function(t,e){if(void 0===e&&(e=4e3),!t||"string"!=typeof t)return"";var n=t.trim().substring(0,e);n=n.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g,"");var a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"};return/&(?:amp|lt|gt|quot|#x27);/.test(n)||(n=n.replace(/[&<>"']/g,(function(t){return a[t]}))),n},t.sanitizeFileData=function(t){var e=[];(!t.name||t.name.length>255)&&e.push("Invalid file name");var n=t.name.toLowerCase().substring(t.name.lastIndexOf("."));return[".exe",".bat",".cmd",".scr",".pif",".vbs",".js",".jar"].includes(n)&&e.push("File type not allowed for security reasons"),t.size>52428800&&e.push("File size exceeds maximum limit"),0===t.size&&e.push("Empty files are not allowed"),{valid:0===e.length,errors:e}},t.isValidUrl=function(t){try{var e=new URL(t);return["http:","https:","mailto:"].includes(e.protocol)}catch(t){return!1}},t.parseAndValidatePayload=function(t){try{var e=JSON.parse(t);return this.sanitizeObject(e)}catch(t){return console.warn("JSON parse error:",t),null}},t.sanitizeObject=function(t,e){var n=this;if(void 0===e&&(e=10),e<=0)return null;if(null===t||"object"!=typeof t)return t;if(Array.isArray(t))return t.map((function(t){return n.sanitizeObject(t,e-1)}));var a={};for(var o in t)"__proto__"!==o&&"constructor"!==o&&"prototype"!==o&&t.hasOwnProperty(o)&&(a[o]=this.sanitizeObject(t[o],e-1));return a},t.checkRateLimit=function(t,e,n){void 0===e&&(e=60),void 0===n&&(n=6e4);var a=Date.now(),o=this.rateLimitMap.get(t);return!o||a-o.lastReset>n?(this.rateLimitMap.set(t,{count:1,lastReset:a}),!0):!(o.count>=e||(o.count++,0))},t.rateLimitMap=new Map,t}(),Y=function(){return Y=Object.assign||function(t){for(var e,n=1,a=arguments.length;n<a;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},Y.apply(this,arguments)},Z=function(t,e,n,a){return new(n||(n=Promise))((function(o,i){function r(t){try{c(a.next(t))}catch(t){i(t)}}function s(t){try{c(a.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,s)}c((a=a.apply(t,e||[])).next())}))},$=function(t,e){var n,a,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},r=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return r.next=s(0),r.throw=s(1),r.return=s(2),"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,s[0]&&(i=0)),i;)try{if(n=1,a&&(o=2&s[0]?a.return:s[0]?a.throw||((o=a.return)&&o.call(a),0):a.next)&&!(o=o.call(a,s[1])).done)return o;switch(a=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,a=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=e.call(t,i)}catch(t){s=[6,t],a=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},G=function(){function t(e){var n;this.persistenceManager=null,this.isInitialized=!1,this.isInitializing=!1,this.isOffline=!1,this.lastMessageCount=0,this.hasUserStartedConversation=!1,this.isFreshConversation=!0,this.supportedMimeTypes=[],this.supportsAttachments=!1,this.agentCapabilities=null,this.clientMetadata={},this.promptTimer=null,this.floatingPromptTimer=null,this.resizeTimeout=null,this.resizeDebounceTimeout=null,this.loadingAnimationInterval=null,this.loadingMessageElement=null,this.currentLoadingStateIndex=0,console.log("üöÄ ChatWidget initializing..."),this.containerId=e.containerId;var a=t.instances.get(this.containerId);a&&a.destroy(),t.instances.set(this.containerId,this),this.config=this.mergeWithDefaultConfig(e),this.theme=this.initializeTheme(),this.assets=this.initializeAssets(),this.state={isOpen:e.initiallyOpen||!1,isExpanded:!1,isInitialized:!1,isSending:!1,messages:[],error:void 0,pendingAttachments:[],isUploadingFiles:!1},this.initializeManagers(),this.conversationId=this.generateUUID(),(null===(n=this.config.persistence)||void 0===n?void 0:n.enabled)&&this.initializePersistence(),this.init()}return t.prototype.initializeManagers=function(){this.stateManager=new x(this.state),this.stateManager.subscribe(this.handleStateChange.bind(this)),this.configManager=new f(this.config),this.messageRenderer=new B,this.fileUploadManager=new m(this.config.apiUrl,this.config.agentToken,this.conversationId),this.styleManager=new z(this.config.variant),this.uiManager=new q(this.config,this.theme,this.assets,this.containerId,{onToggle:this.toggleChat.bind(this),onSend:this.handleSendMessage.bind(this),onInputKey:this.handleInputKeypress.bind(this),onResize:this.handleResize.bind(this),onExpand:this.handleExpandClick.bind(this),onPromptClick:this.handlePromptClick.bind(this),onAttachmentClick:this.handleAttachmentClick.bind(this),onFileSelect:this.handleFileSelect.bind(this),onAttachmentRemove:this.handleAttachmentRemove.bind(this)}),this.conversationManager=new R(this.config,this.theme,{onNewConversation:this.handleNewConversation.bind(this),onSwitchConversation:this.handleSwitchConversation.bind(this),onDeleteConversation:this.handleDeleteConversation.bind(this),onToggleListView:this.handleToggleListView.bind(this)})},t.prototype.initializePersistence=function(){var t;this.persistenceManager=new l(this.containerId,this.stateManager,!0),this.persistenceManager.migrateLegacy();var e=null!==(t=this.persistenceManager.getCurrentId())&&void 0!==t?t:this.persistenceManager.create();this.conversationId=e},t.prototype.init=function(){return Z(this,void 0,void 0,(function(){var t;return $(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),console.log("üì¶ ChatAgent loading dependencies..."),[4,this.loadDependencies()];case 1:return e.sent(),this.isOffline=!1,[3,3];case 2:return t=e.sent(),console.warn("Failed to load dependencies:",t),this.fallbackToOfflineMode(),[3,3];case 3:return this.initialize(),this.config.enableAttachments&&this.fetchAgentCapabilities(),console.log("‚úÖ ChatWidget initialized successfully"),[2]}}))}))},t.prototype.loadDependencies=function(){return Z(this,void 0,void 0,(function(){return $(this,(function(t){return window.marked?(this.configureMarked(),[2]):(this.fallbackToOfflineMode(),[2])}))}))},t.prototype.configureMarked=function(){window.marked&&window.marked.setOptions({gfm:!0,breaks:!0,headerIds:!1,mangle:!1,sanitize:!0})},t.prototype.fallbackToOfflineMode=function(){this.isOffline=!0,window.marked={setOptions:function(){},parse:function(t){return T.parse(t)}}},t.prototype.initialize=function(){var t=this;if(!this.isInitialized){if(console.log("üé® ChatWidget creating UI..."),this.styleManager.injectStyles(),this.element=this.uiManager.createAndMount(),this.fallbackToOfflineMode(),!1!==this.config.collectClientMetadata){if(this.clientMetadata=K.collect(this.config.clientMetadata),console.log("üîç Collected client metadata:",this.clientMetadata),this.config.collectIPAddress){console.log("üåê Fetching IP address and geolocation...");var e=Y({},this.clientMetadata);K.collectWithIP(this.config.clientMetadata).then((function(n){JSON.stringify(t.clientMetadata)===JSON.stringify(e)?(t.clientMetadata=n,console.log("‚úÖ Updated metadata with IP:",n)):(console.log("‚ö†Ô∏è Metadata changed during IP collection, merging..."),n.ip_address&&!t.clientMetadata.ip_address&&(t.clientMetadata.ip_address=n.ip_address),n.geo_location&&!t.clientMetadata.geo_location&&(t.clientMetadata.geo_location=n.geo_location))})).catch((function(t){console.warn("‚ö†Ô∏è Failed to fetch IP address:",t)}))}}else this.config.clientMetadata&&(this.clientMetadata=this.config.clientMetadata,console.log("üìã Using provided client metadata:",this.clientMetadata));this.persistenceManager&&this.setupConversationManagement();var n=!0;if(this.persistenceManager){var a=this.persistenceManager.loadMessages(),o=this.persistenceManager.loadMetadata();if(o?(console.log("üìã Initial load - restoring agent capabilities from persisted metadata:",o),this.processAgentCapabilities(o)):console.log("‚ö†Ô∏è Initial load - no persisted metadata found, will initialize from API"),a.length>0){this.stateManager.clearMessages(),a.forEach((function(e){return t.addMessage(e)})),this.lastMessageCount=a.filter((function(t){return"agent"===t.sender})).length;var i=a.filter((function(t){return"user"===t.sender}));this.hasUserStartedConversation=i.length>0,this.isFreshConversation=!1,n=!o}}n&&this.initializeChat(),this.uiManager.updateUI(this.stateManager.getState()),this.uiManager.updateTheme(this.theme),this.isInitialized=!0,console.log("üéâ ChatWidget UI initialized")}},t.prototype.createElements=function(){var t=document.querySelector('.am-chat-widget[data-container="'.concat(this.containerId,'"]'));if(t&&t.remove(),this.element=document.createElement("div"),this.element.className="am-chat-widget am-chat-widget--".concat(this.config.variant),this.element.setAttribute("data-container",this.containerId),this.element.innerHTML=this.generateTemplate(),"inline"===this.config.variant){var e=document.getElementById(this.containerId);if(!e)return void console.error('Container with id "'.concat(this.containerId,'" not found'));e.innerHTML="",e.appendChild(this.element)}else document.body.appendChild(this.element)},t.prototype.generateTemplate=function(){var t="corner"===this.config.variant;return"\n      ".concat(t?'\n        <button class="am-chat-toggle" style="background-color: '.concat(this.theme.toggleBackgroundColor,' !important;">\n          <div class="am-chat-toggle-content">\n            <span class="am-chat-toggle-text" style="color: ').concat(this.theme.toggleTextColor,' !important;">\n              ').concat(this.config.toggleText||"AI Assistant","\n            </span>\n          </div>\n        </button>\n      "):"",'\n      <div class="am-chat-container" style="display: ').concat(this.state.isOpen||"corner"!==this.config.variant?"flex":"none",';">\n        <div class="am-chat-header" style="background-color: white; color: #333;">\n          <div class="am-chat-header-content">\n            <span>').concat(this.config.title,'</span>\n            <button class="am-chat-minimize">√ó</button>\n          </div>\n        </div>\n        <div class="am-chat-messages" style="background-color: ').concat(this.theme.backgroundColor,"; color: ").concat(this.theme.textColor,';"></div>\n        <div class="am-chat-input-container">\n          <textarea class="am-chat-input" placeholder="').concat(this.config.placeholder||"Type your message...",'"></textarea>\n          <button class="am-chat-send" style="background-color: ').concat(this.theme.buttonColor,"; color: ").concat(this.theme.buttonTextColor,';">Send</button>\n        </div>\n        <div class="am-chat-branding">Powered by <a href="https://agentman.ai" target="_blank">Agentman</a></div>\n      </div>\n    ')},t.prototype.attachEventListeners=function(){var t=this,e=this.element.querySelector(".am-chat-toggle"),n=this.element.querySelector(".am-chat-minimize"),a=this.element.querySelector(".am-chat-send"),o=this.element.querySelector(".am-chat-input");e&&e.addEventListener("click",(function(){return t.toggleChat()})),n&&n.addEventListener("click",(function(){return t.toggleChat()})),a&&a.addEventListener("click",(function(){return t.handleSendMessage()})),o&&o.addEventListener("keydown",(function(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),t.handleSendMessage())}))},t.prototype.handleStateChange=function(t){this.uiManager.updateUI(t),this.updateFloatingPrompts(t)},t.prototype.updateFloatingPrompts=function(t){var e=this;"corner"===this.config.variant&&(!t.isOpen&&!this.hasUserStartedConversation&&this.isFreshConversation&&window.innerWidth>768?this.floatingPromptTimer||(this.floatingPromptTimer=window.setTimeout((function(){e.uiManager.showFloatingPrompts(),e.floatingPromptTimer=null}),5e3)):(this.floatingPromptTimer&&(clearTimeout(this.floatingPromptTimer),this.floatingPromptTimer=null),this.uiManager.hideFloatingPrompts()),t.isOpen&&!this.hasUserStartedConversation&&this.isFreshConversation?this.uiManager.showMessagePrompts():t.isOpen&&this.uiManager.hideMessagePrompts())},t.prototype.toggleChat=function(){if("corner"===this.config.variant){var t=!this.stateManager.getState().isOpen;this.stateManager.setOpen(t)}},t.prototype.initializeChat=function(){return Z(this,void 0,void 0,(function(){var t,e,n,a,o,i;return $(this,(function(r){switch(r.label){case 0:if(console.log("üåü initializeChat() called"),this.state.isInitialized||this.isInitializing)return console.log("‚è≠Ô∏è initializeChat() aborted - already initialized or initializing"),[2];this.isInitializing=!0,this.showLoadingIndicator(),this.lastMessageCount=0,console.log("üöß Starting chat initialization"),r.label=1;case 1:return r.trys.push([1,4,5,6]),t=this.config.initialMessage||"Hello",console.log('üí¨ Using initial message: "'.concat(t,'"')),console.log("üîó Conversation ID: ".concat(this.conversationId)),[4,fetch("".concat(this.config.apiUrl,"/v2/agentman_runtime/agent"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Y({agent_token:this.config.agentToken,force_load:!1,conversation_id:this.conversationId,user_input:t},Object.keys(this.clientMetadata).length>0?{client_metadata:this.clientMetadata}:{}))})];case 2:if(!(e=r.sent()).ok)throw new Error("HTTP error! status: ".concat(e.status));return[4,e.text()];case 3:if(n=r.sent(),!(a=J.parseAndValidatePayload(n)))throw new Error("Invalid response format from server");return a.response&&(console.log("üì° Received initial response data"),this.handleInitialResponse(a.response),a.metadata&&this.processAgentCapabilities(a.metadata),this.persistenceManager&&(console.log("üîç Checking if welcome message is saved to persistence"),o=this.stateManager.getState().messages,console.log("üìä Current message count after welcome: ".concat(o.length)))),this.stateManager.setInitialized(!0),[3,6];case 4:return i=r.sent(),console.error("Chat initialization error:",i),this.stateManager.setError("Failed to initialize chat. Please try again."),this.config.initialMessage&&this.addMessage({id:this.generateUUID(),sender:"agent",content:this.config.initialMessage,timestamp:(new Date).toISOString(),type:"text"}),[3,6];case 5:return this.isInitializing=!1,this.hideLoadingIndicator(),[7];case 6:return[2]}}))}))},t.prototype.handleInitialResponse=function(t){var e;if(console.log("üëã handleInitialResponse() called"),Array.isArray(t)){void 0===this.lastMessageCount&&(this.lastMessageCount=0);var n=t.slice(this.lastMessageCount);console.log("üí¨ Processing ".concat(n.length," new messages from initial response"));for(var a=0,o=n;a<o.length;a++){var i=o[a];"ai"===i.type?this.isValidMessage(i)&&i.content.trim()&&(console.log("‚ûï Adding welcome message to UI"),this.addMessage({id:null!==(e=i.id)&&void 0!==e?e:this.generateUUID(),sender:"agent",content:i.content,timestamp:(new Date).toISOString(),type:"text"})):console.log("‚è≠Ô∏è Skipping human message in initial response")}this.lastMessageCount=t.length}else console.error("Invalid response format:",t)},t.prototype.handleSendMessage=function(){return Z(this,void 0,void 0,(function(){var t,e,n,a,o,i,r;return $(this,(function(s){switch(s.label){case 0:if(t=this.uiManager.getElement(".am-chat-input"),e=(null==t?void 0:t.value)||"",n=J.sanitizeUserInput(e).trim(),a=this.stateManager.getState().pendingAttachments||[],o=a.length>0,!n&&!o||this.state.isSending)return[2];if(!J.checkRateLimit("chat_".concat(this.containerId),30,6e4))return console.warn("Rate limit exceeded for chat messages"),[2];this.hasUserStartedConversation=!0,this.isFreshConversation=!1,this.uiManager.hideMessagePrompts(),this.uiManager.hideFloatingPrompts(),this.stateManager.setSending(!0),s.label=1;case 1:return s.trys.push([1,3,4,5]),t&&(t.value="",t.style.height="auto"),(i=this.uiManager.getElement(".am-chat-send"))&&(i.disabled=!0),[4,this.sendMessage(n||"")];case 2:return s.sent(),[3,5];case 3:return r=s.sent(),console.error("Error sending message:",r),[3,5];case 4:return this.stateManager.setSending(!1),[7];case 5:return[2]}}))}))},t.prototype.sendMessage=function(t){return Z(this,void 0,void 0,(function(){var e,n,a,o,i,r,s,c,l,d;return $(this,(function(h){switch(h.label){case 0:e=this.generateUUID(),n=this.config.enableAttachments?this.stateManager.getState().pendingAttachments.filter((function(t){return"success"===t.upload_status})):[],a={id:e,sender:"user",content:t,timestamp:(new Date).toISOString(),type:"text",attachments:n.length>0?n:void 0},this.addMessage(a),this.config.enableAttachments&&n.length>0&&(this.stateManager.clearPendingAttachments(),this.updateAttachmentPreview()),this.showLoadingIndicator(),h.label=1;case 1:return h.trys.push([1,7,,8]),o=Y({agent_token:this.config.agentToken,force_load:!1,conversation_id:this.conversationId,user_input:t},Object.keys(this.clientMetadata).length>0?{client_metadata:this.clientMetadata}:{}),n.length>0&&(i=n.filter((function(t){return t.url})).map((function(t){return t.url}))).length>0&&(o.attachment_urls=i),console.log("üîÑ Sending message to API:",{url:"".concat(this.config.apiUrl,"/v2/agentman_runtime/agent"),body:o}),[4,fetch("".concat(this.config.apiUrl,"/v2/agentman_runtime/agent"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)})];case 2:if(!(r=h.sent()).ok)throw new Error("HTTP error! status: ".concat(r.status));return[4,r.text()];case 3:if(s=h.sent(),!(c=J.parseAndValidatePayload(s)))throw new Error("Invalid response format from server");return console.log("üì® Received API response:",c),this.hideLoadingIndicator(),Array.isArray(c.response)?[4,this.handleResponse(c.response)]:[3,5];case 4:return h.sent(),c.metadata&&(console.log("üíæ Processing updated agent metadata from response"),this.processAgentCapabilities(c.metadata)),this.persistenceManager&&(console.log("üíæ Saving messages after response processed"),this.persistenceManager.saveMessages()),[3,6];case 5:console.error("Invalid response format:",c),this.addErrorMessage("Invalid response format from agent"),h.label=6;case 6:return[3,8];case 7:return l=h.sent(),console.error("Message sending error:",l),this.hideLoadingIndicator(),d="Sorry, I encountered an error. Please try again.",l instanceof Error&&(l.message.includes("Failed to fetch")?d="Unable to connect to the agent service. Please check your connection and try again.":l.message.includes("401")?d="Authentication failed. Please check your agent token.":l.message.includes("404")&&(d="Agent service not found. Please check the API URL.")),this.addErrorMessage(d),[3,8];case 8:return[2]}}))}))},t.prototype.handleResponse=function(t){return Z(this,void 0,void 0,(function(){var e,n,a,o,i,r,s,c;return $(this,(function(l){if(!Array.isArray(t))return console.error("Invalid response format:",t),[2];for(void 0===this.lastMessageCount&&(this.lastMessageCount=0),console.log("üîç Processing response with ".concat(t.length," messages, lastMessageCount=").concat(this.lastMessageCount)),e=t.slice(this.lastMessageCount),console.log("üîÑ Found ".concat(e.length," new messages")),n=this.stateManager.getState().messages,a=n.map((function(t){return t.content.trim()})),o=0,i=e;o<i.length;o++)"ai"===(r=i[o]).type?(s=r.content.trim(),a.includes(s)?console.log("‚è≠Ô∏è Skipping duplicate message: "+s.substring(0,30)+"..."):this.isValidMessage(r)&&s&&(console.log("‚ûï Adding new agent message"),this.addMessage({id:null!==(c=r.id)&&void 0!==c?c:this.generateUUID(),sender:"agent",content:s,timestamp:(new Date).toISOString(),type:"text"}))):console.log("‚è≠Ô∏è Skipping human message");return this.lastMessageCount=t.length,console.log("‚úÖ Updated lastMessageCount to ".concat(this.lastMessageCount)),[2]}))}))},t.prototype.addErrorMessage=function(t){var e={id:this.generateUUID(),sender:"agent",content:t,timestamp:(new Date).toISOString(),type:"text"};this.addMessage(e)},t.prototype.isValidMessage=function(t){return"object"==typeof t&&null!==t&&"type"in t&&"content"in t&&"string"==typeof t.content},t.prototype.showLoadingIndicator=function(){if(!this.loadingMessageElement){var t=this.uiManager.getElement(".am-chat-messages");t&&(this.loadingMessageElement=document.createElement("div"),this.loadingMessageElement.className="am-message agent am-chat-loading-message",this.loadingMessageElement.innerHTML='\n      <div class="am-message-role">Assistant</div>\n      <div class="am-message-content">\n        <div class="loading-container">\n          <div class="loading-waves">\n            <span></span><span></span><span></span><span></span><span></span>\n          </div>\n        </div>\n      </div>\n    ',t.appendChild(this.loadingMessageElement),t.scrollTop=t.scrollHeight)}},t.prototype.hideLoadingIndicator=function(){this.loadingMessageElement&&(this.loadingMessageElement.remove(),this.loadingMessageElement=null),this.loadingAnimationInterval&&(window.clearInterval(this.loadingAnimationInterval),this.loadingAnimationInterval=null)},t.prototype.startLoadingAnimation=function(){},t.prototype.handleInputKeypress=function(t){"Enter"!==t.key||t.shiftKey||(t.preventDefault(),this.handleSendMessage())},t.prototype.handleResize=function(){},t.prototype.handlePromptClick=function(t){var e=this.uiManager.getElement(".am-chat-input");e&&(e.value=t,e.focus(),this.handleSendMessage())},t.prototype.handleExpandClick=function(){var t;this.element&&(this.element.classList.contains("am-chat-expanded")?(this.element.classList.remove("am-chat-expanded"),(t=this.uiManager.getElement(".am-chat-expand"))&&(t.innerHTML=D,t.title="Expand chat")):(this.element.classList.add("am-chat-expanded"),(t=this.uiManager.getElement(".am-chat-expand"))&&(t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">\n  <path stroke-linecap="round" stroke-linejoin="round" d="M9 9V4.5M9 9H4.5M9 9 3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9h4.5M15 9V4.5M15 9l5.25-5.25M15 15h4.5M15 15v4.5m0-4.5 5.25 5.25" />\n</svg>',t.title="Collapse chat")))},t.prototype.setupConversationManagement=function(){if(this.persistenceManager&&this.element){var t=this.uiManager.getElement(".am-chat-container");if(t){var e=this.conversationManager.createConversationListView();t.appendChild(e)}var n=this.persistenceManager.list().length>1,a=this.uiManager.getElement(".am-chat-header");a&&(this.conversationManager.addConversationButton(a,n),this.conversationManager.addNewConversationButton(a),this.conversationManager.addHeaderDivider(a),this.conversationManager.addBackButton(a)),this.updateConversationList()}},t.prototype.updateConversationList=function(){if(this.persistenceManager){var t=this.persistenceManager.list(),e=this.persistenceManager.getCurrentId();this.conversationManager.updateConversationList(t,e),this.updateConversationHeaderButtons()}},t.prototype.updateConversationHeaderButtons=function(){if(this.persistenceManager){var t=this.persistenceManager.list(),e=t.length>1,n=this.uiManager.getElement(".am-chat-header");if(console.log("üîç [DEBUG] Updating header buttons - ".concat(t.length," conversations, hasConversations: ").concat(e)),n){var a=n.querySelector(".am-conversation-toggle");e&&!a&&(console.log("üîç [DEBUG] Adding missing conversation button"),this.conversationManager.addConversationButton(n,e),a=n.querySelector(".am-conversation-toggle")),a&&(a.style.display=e&&!this.conversationManager.isListViewActive()?"block":"none",console.log("üîç [DEBUG] Conversation button display: ".concat(a.style.display))),this.conversationManager.updateHeaderButtons(n)}}},t.prototype.handleNewConversation=function(){if(this.persistenceManager){this.persistenceManager.saveMessages();var t=this.persistenceManager.create();this.conversationId=t,this.stateManager.clearMessages(),this.clearMessagesUI(),this.hasUserStartedConversation=!1,this.isFreshConversation=!0,this.initializeChat(),this.updateConversationList(),this.updateFloatingPrompts(this.stateManager.getState()),this.conversationManager.isListViewActive()&&this.conversationManager.toggleListView(),console.log("‚úÖ Created new conversation: ".concat(t))}},t.prototype.handleSwitchConversation=function(t){var e=this;if(this.persistenceManager&&t!==this.conversationId){this.persistenceManager.saveMessages(),this.persistenceManager.switchTo(t),this.conversationId=t;var n=this.persistenceManager.loadMessages(),a=this.persistenceManager.loadMetadata();a?this.processAgentCapabilities(a):console.log("‚ö†Ô∏è No metadata found for conversation, keeping current capabilities");var o=n.filter((function(t){return"user"===t.sender}));this.hasUserStartedConversation,this.hasUserStartedConversation=o.length>0,this.isFreshConversation=!1,this.stateManager.clearMessages(),this.clearMessagesUI(),n.forEach((function(t){return e.addMessage(t)})),this.updateConversationList(),this.updateFloatingPrompts(this.stateManager.getState()),this.conversationManager.isListViewActive()&&this.conversationManager.toggleListView(),console.log("‚úÖ Switched to conversation: ".concat(t))}},t.prototype.handleDeleteConversation=function(t){if(this.persistenceManager){var e=this.persistenceManager.getCurrentId();if(this.persistenceManager.delete(t),t===e){var n=this.persistenceManager.list();n.length>0?this.handleSwitchConversation(n[0].id):this.handleNewConversation()}this.updateConversationList(),console.log("‚úÖ Deleted conversation: ".concat(t))}},t.prototype.handleToggleListView=function(){var t=this.uiManager.getElement(".am-chat-container"),e=this.uiManager.getElement(".am-chat-header");if(t&&e){var n=this.conversationManager.isListViewActive(),a=t.querySelector(".am-chat-messages"),o=t.querySelector(".am-chat-branding"),i=t.querySelectorAll(".am-chat-input-prompts, .am-chat-input-container, .chat-attachments-preview");n?(a&&a.classList.add("sliding-out"),i.forEach((function(t){t.classList.add("sliding-out")})),setTimeout((function(){a&&(a.style.display="none"),i.forEach((function(t){t.style.display="none"}))}),300)):(a&&(a.style.display="",a.classList.remove("sliding-out")),i.forEach((function(t){t.style.display="",t.classList.remove("sliding-out")}))),o&&(o.style.display=""),this.conversationManager.updateHeaderButtons(e);var r=e.querySelector(".am-chat-header-content span");r&&(r.textContent=n?"Conversations":this.config.title||"Chat Agent")}console.log("üìÇ Conversation list view toggled:",this.conversationManager.isListViewActive())},t.prototype.clearMessagesUI=function(){var t=this.uiManager.getElement(".am-chat-messages");t&&t.querySelectorAll(".am-message").forEach((function(t){return t.remove()}))},t.prototype.handleAttachmentClick=function(){var t=this.uiManager.getElement(".chat-file-input");t&&t.click()},t.prototype.handleFileSelect=function(t){var e=this;this.config.enableAttachments&&this.fileUploadManager&&(Array.from(t).forEach((function(t){return Z(e,void 0,void 0,(function(){var e,n,a,o,i=this;return $(this,(function(r){switch(r.label){case 0:if(!(e=J.sanitizeFileData(t)).valid)return console.warn("üö´ File validation failed: ".concat(e.errors.join(", "))),[2];if(this.supportedMimeTypes.length>0&&!this.supportedMimeTypes.includes(t.type))return console.warn("üö´ File type not supported: ".concat(t.type,". Supported types: ").concat(this.supportedMimeTypes.join(", "))),this.stateManager.setError('File type "'.concat(t.type||"unknown",'" is not supported. Supported types: ').concat(this.supportedMimeTypes.map((function(t){var e;return null===(e=t.split("/")[1])||void 0===e?void 0:e.toUpperCase()})).join(", "))),[2];n={file_id:"temp_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),filename:t.name,content_type:t.type||"application/octet-stream",file_type:this.getFileType(t),size_bytes:t.size,upload_status:"uploading",upload_progress:0},this.stateManager.addPendingAttachment(n),this.updateAttachmentPreview(),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.fileUploadManager.uploadFile(t,(function(t){i.stateManager.updateAttachmentStatus(n.file_id,{upload_progress:t}),i.updateAttachmentPreview()}))];case 2:return a=r.sent(),this.stateManager.updateAttachmentStatus(n.file_id,Y(Y({},a),{upload_status:"success"})),this.updateAttachmentPreview(),[3,4];case 3:return o=r.sent(),console.error("File upload failed:",o),this.stateManager.updateAttachmentStatus(n.file_id,{upload_status:"error",error_message:o instanceof Error?o.message:"Upload failed"}),this.updateAttachmentPreview(),[3,4];case 4:return[2]}}))}))})),this.uiManager.clearFileInput())},t.prototype.getFileType=function(t){var e,n=t.type.toLowerCase();if(n.startsWith("image/"))return"image";if(n.startsWith("audio/"))return"audio";if(n.startsWith("video/"))return"video";if(n.startsWith("text/")||n.includes("text"))return"text";switch(null===(e=t.name.split(".").pop())||void 0===e?void 0:e.toLowerCase()){case"pdf":case"doc":case"docx":case"ppt":case"pptx":case"xls":case"xlsx":return"document";case"mp3":case"wav":case"ogg":return"audio";case"mp4":case"avi":case"mov":return"video";case"txt":case"md":case"json":case"csv":return"text";default:return"data"}},t.prototype.handleAttachmentRemove=function(t){this.stateManager.removePendingAttachment(t),this.updateAttachmentPreview()},t.prototype.updateAttachmentPreview=function(){if(this.config.enableAttachments){var t=this.stateManager.getState().pendingAttachments;this.uiManager.updateAttachmentPreview(t)}},t.prototype.addMessage=function(t){var e=this.uiManager.getElement(".am-chat-messages");if(e){this.stateManager.addMessage(t);var n=document.createElement("div");n.className="am-message ".concat(t.sender);var a=this.messageRenderer.render(t),o=this.renderMessageAttachments(t);"user"===t.sender?n.innerHTML='\n        <div class="am-message-role">You</div>\n        <div class="am-message-content">\n          '.concat(a,"\n          ").concat(o,"\n        </div>\n      "):n.innerHTML='\n        <div class="am-message-role">Assistant</div>\n        <div class="am-message-content">\n          '.concat(a,"\n          ").concat(o,"\n        </div>\n      "),e.appendChild(n),e.scrollTop=e.scrollHeight}else console.error("Messages container not found")},t.prototype.renderMessageAttachments=function(t){var e=this;if(!t.attachments||0===t.attachments.length)return"";var n=t.attachments.map((function(t){var n="image"===t.file_type&&t.url,a=e.getAttachmentIcon(t.file_type),o=e.escapeHtml(t.filename),i=e.formatFileSize(t.size_bytes);return n?'\n          <div class="chat-message-attachment">\n            <img src="'.concat(t.url,'" \n                 alt="').concat(o,'" \n                 class="message-attachment-image"\n                 onclick="window.open(\'').concat(t.url,"', '_blank')\"\n                 loading=\"lazy\">\n          </div>\n        "):'\n          <a href="'.concat(t.url||"#",'" \n             class="chat-message-attachment" \n             target="_blank" \n             rel="noopener noreferrer"\n             ').concat(t.url?"":'onclick="return false;" style="cursor: not-allowed; opacity: 0.5;"','>\n            <div class="message-attachment-icon">').concat(a,'</div>\n            <div class="chat-attachment-info">\n              <div class="chat-attachment-name">').concat(o,'</div>\n              <div class="chat-attachment-size">').concat(i,"</div>\n            </div>\n          </a>\n        ")})).join("");return'<div class="chat-message-attachments">'.concat(n,"</div>")},t.prototype.getAttachmentIcon=function(t){switch(t){case"image":return"üñºÔ∏è";case"document":return"üìÑ";case"audio":return"üéµ";case"video":return"üé¨";case"text":return"üìù";case"data":return"üìä";default:return"üìé"}},t.prototype.formatFileSize=function(t){if(0===t)return"0 Bytes";var e=Math.floor(Math.log(t)/Math.log(1024));return parseFloat((t/Math.pow(1024,e)).toFixed(2))+" "+["Bytes","KB","MB","GB"][e]},t.prototype.escapeHtml=function(t){var e=document.createElement("div");return e.textContent=t,e.innerHTML},t.prototype.clearStorage=function(){if(this.persistenceManager){this.persistenceManager.clearStorage(),this.stateManager.clearMessages();var t=this.uiManager.getElement(".am-chat-messages");t&&(t.innerHTML="")}},t.prototype.destroy=function(){console.log("üßπ ChatWidget destroying..."),this.promptTimer&&window.clearTimeout(this.promptTimer),this.resizeTimeout&&window.clearTimeout(this.resizeTimeout),this.resizeDebounceTimeout&&window.clearTimeout(this.resizeDebounceTimeout),this.loadingAnimationInterval&&window.clearInterval(this.loadingAnimationInterval),this.styleManager.cleanup(),this.stateManager.clearListeners(),this.uiManager.destroy(),this.conversationManager&&this.conversationManager.destroy(),t.instances.delete(this.containerId),console.log("‚úÖ ChatWidget destroyed")},t.getInstance=function(e){return t.instances.get(e)},t.destroyAll=function(){Array.from(t.instances.values()).forEach((function(t){t.destroy()})),t.instances.clear()},t.prototype.mergeWithDefaultConfig=function(t){return Y(Y({},t),{title:t.title||"Chat Widget",theme:Y({textColor:"#111827",backgroundColor:"#FFFFFF",buttonColor:"#2563eb",buttonTextColor:"#FFFFFF"},t.theme),placeholder:t.placeholder||"Type your message...",initiallyOpen:t.initiallyOpen||!1})},t.prototype.initializeTheme=function(){var t,e,n,a,o,i,r,s,c;return{textColor:(null===(t=this.config.theme)||void 0===t?void 0:t.textColor)||"#111827",backgroundColor:(null===(e=this.config.theme)||void 0===e?void 0:e.backgroundColor)||"#FFFFFF",buttonColor:(null===(n=this.config.theme)||void 0===n?void 0:n.buttonColor)||"#2563eb",buttonTextColor:(null===(a=this.config.theme)||void 0===a?void 0:a.buttonTextColor)||"#FFFFFF",agentForegroundColor:(null===(o=this.config.theme)||void 0===o?void 0:o.agentForegroundColor)||"#111827",userForegroundColor:(null===(i=this.config.theme)||void 0===i?void 0:i.userForegroundColor)||"#2563eb",toggleBackgroundColor:(null===(r=this.config.theme)||void 0===r?void 0:r.toggleBackgroundColor)||"#2563eb",toggleTextColor:(null===(s=this.config.theme)||void 0===s?void 0:s.toggleTextColor)||"#FFFFFF",toggleIconColor:(null===(c=this.config.theme)||void 0===c?void 0:c.toggleIconColor)||"#2563eb"}},t.prototype.initializeAssets=function(){return{logo:this.config.logo||"",headerLogo:this.config.headerLogo||""}},t.prototype.generateUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}))},t.prototype.processAgentCapabilities=function(t){console.log("üîç Processing agent capabilities from metadata:",t);var e=J.validateAgentMetadata(t);if(!e)return console.warn("‚ö†Ô∏è Invalid agent metadata received, using defaults"),this.agentCapabilities={},this.supportedMimeTypes=[],void(this.supportsAttachments=!1);this.agentCapabilities=e,this.supportedMimeTypes=e.supported_mime_types||[],this.supportsAttachments=e.supports_attachments||!1,console.log("üìã Agent capabilities extracted:",{supportedMimeTypes:this.supportedMimeTypes,supportsAttachments:this.supportsAttachments}),this.persistenceManager&&this.persistenceManager.saveMetadata(e),this.config.enableAttachments&&this.supportsAttachments?this.updateFileInputAccept():this.config.enableAttachments&&!this.supportsAttachments&&(console.warn("‚ö†Ô∏è Attachments enabled in config but agent does not support attachments"),this.disableAttachmentButton())},t.prototype.updateFileInputAccept=function(){var t=this.uiManager.getElement(".chat-file-input");t&&this.supportedMimeTypes.length>0&&(t.accept=this.supportedMimeTypes.join(","),console.log("üìé Updated file input accept attribute: ".concat(t.accept)),this.supportedMimeTypes.some((function(t){return t.startsWith("image/")}))&&(t.setAttribute("capture","environment"),console.log("üì± Added camera capture support for mobile devices"))),this.updateAttachmentButtonTooltip()},t.prototype.updateAttachmentButtonTooltip=function(){var t=this.uiManager.getElement(".chat-attachment-button");if(t&&this.supportedMimeTypes.length>0){var e=this.supportedMimeTypes.map((function(t){var e;return null===(e=t.split("/")[1])||void 0===e?void 0:e.toUpperCase()})).filter(Boolean).join(", "),n=this.supportedMimeTypes.some((function(t){return t.startsWith("image/")}))?" or take photo":"";t.title="Attach files (".concat(e," supported)").concat(n),console.log("üìé Updated attachment button tooltip: ".concat(t.title))}},t.prototype.disableAttachmentButton=function(){var t=this.uiManager.getElement(".chat-attachment-button");t&&(t.disabled=!0,t.title="File attachments not supported by this agent",t.style.opacity="0.5",console.log("üìé Disabled attachment button - agent does not support attachments"))},t.prototype.fetchAgentCapabilities=function(){return Z(this,void 0,void 0,(function(){return $(this,(function(t){return console.log("üîç fetchAgentCapabilities() called - capabilities now extracted from initial response metadata"),[2]}))}))},t.instances=new Map,t}();return a.ChatWidget})()));