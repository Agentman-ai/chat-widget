<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Final Fixes - Agentman Chat Widget</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            margin-top: 0;
            color: #333;
        }
        
        .test-section {
            margin: 30px 0;
            padding: 20px;
            background: #f9fafb;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }
        
        .test-section h2 {
            margin-top: 0;
            color: #2563eb;
            font-size: 18px;
        }
        
        .widget-container {
            height: 600px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .checklist {
            list-style: none;
            padding: 0;
        }
        
        .checklist li {
            padding: 8px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .checklist li:before {
            content: 'âœ“';
            width: 20px;
            height: 20px;
            background: #10b981;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }
        
        .issue-fixed {
            color: #10b981;
            font-weight: 500;
        }
        
        .controls {
            margin-top: 20px;
            display: flex;
            gap: 10px;
        }
        
        button {
            padding: 8px 16px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            font-size: 14px;
        }
        
        button:hover {
            background: #f9fafb;
        }
        
        button.primary {
            background: #2563eb;
            color: white;
            border-color: #2563eb;
        }
        
        button.primary:hover {
            background: #1d4ed8;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Final Fixes Test</h1>
        <p>This page tests the three issues that were fixed:</p>
        
        <div class="test-section">
            <h2>Issues Fixed</h2>
            <ul class="checklist">
                <li>
                    <span class="issue-fixed">Scrollbar Visibility</span> - Scrollbar now shows when content is scrollable
                </li>
                <li>
                    <span class="issue-fixed">Header Icons</span> - Using the same icons as original ChatWidget.ts
                </li>
                <li>
                    <span class="issue-fixed">New Conversation Button</span> - Added "New" button that returns to welcome screen
                </li>
            </ul>
        </div>
        
        <div class="test-section">
            <h2>Test Instructions</h2>
            <ol>
                <li>Click on the inline widget below to see the welcome screen</li>
                <li>Enter a message or click a prompt to start a conversation</li>
                <li>Check that the header shows:
                    <ul>
                        <li>"New" button with plus icon (takes you back to welcome)</li>
                        <li>Divider line</li>
                        <li>Expand button (desktop only)</li>
                        <li>Minimize button</li>
                    </ul>
                </li>
                <li>Add multiple messages to test scrolling - scrollbar should be visible</li>
                <li>Click "New" to return to the welcome screen</li>
            </ol>
        </div>
        
        <div class="test-section">
            <h2>Live Widget Test</h2>
            <div id="inline-widget" class="widget-container"></div>
            
            <div class="controls">
                <button class="primary" onclick="addTestMessages()">Add Test Messages</button>
                <button onclick="checkScrollbar()">Check Scrollbar</button>
                <button onclick="testNewButton()">Test New Button</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { ChatWidget } from './assistantWidget/ChatWidgetRefactored.js';
        
        // Initialize widget
        const widget = new ChatWidget({
            agentToken: 'test-token',
            containerId: 'inline-widget',
            variant: 'inline',
            apiUrl: 'https://demo-api.agentman.ai',
            title: 'AI Assistant',
            placeholder: 'Type your message...',
            messagePrompts: {
                show: true,
                welcome_message: 'Hello! How can I help you today?',
                prompts: [
                    'Tell me about your features',
                    'How do I get started?',
                    'What can you help me with?',
                    'Show me an example'
                ]
            },
            theme: {
                backgroundColor: '#ffffff',
                textColor: '#111827',
                buttonColor: '#2563eb',
                buttonTextColor: '#ffffff'
            }
        });
        
        // Expose widget globally for testing
        window.widget = widget;
        
        // Test functions
        window.addTestMessages = async function() {
            // Ensure we're in conversation view
            if (widget.getCurrentView() === 'welcome') {
                const viewManager = widget.viewManager;
                if (viewManager) {
                    await viewManager.transitionToConversation();
                }
            }
            
            // Add test messages
            const messages = [
                { sender: 'user', content: 'Test message 1' },
                { sender: 'agent', content: 'Response 1: This is a response to demonstrate scrolling functionality.' },
                { sender: 'user', content: 'Test message 2' },
                { sender: 'agent', content: 'Response 2: Let me add more content here.\n\nThis response has multiple paragraphs to take up more space.\n\nWe want to ensure the scrollbar becomes visible.' },
                { sender: 'user', content: 'Test message 3' },
                { sender: 'agent', content: 'Response 3: Adding even more messages to trigger scrolling.\n\n## Here\'s a heading\n\n- Bullet point 1\n- Bullet point 2\n- Bullet point 3' },
                { sender: 'user', content: 'Test message 4' },
                { sender: 'agent', content: 'Response 4: By now the scrollbar should definitely be visible!' },
                { sender: 'user', content: 'Final test message' },
                { sender: 'agent', content: 'Final response: You should now see a styled scrollbar on the right side of the messages area.' }
            ];
            
            for (const msg of messages) {
                const message = {
                    id: Date.now() + Math.random(),
                    sender: msg.sender,
                    content: msg.content,
                    timestamp: new Date().toISOString(),
                    attachments: []
                };
                widget.addMessageToView(message);
                await new Promise(resolve => setTimeout(resolve, 300));
            }
            
            alert('Test messages added. Check for scrollbar visibility!');
        };
        
        window.checkScrollbar = function() {
            const messagesContainer = document.querySelector('.am-chat-messages');
            if (!messagesContainer) {
                alert('Messages container not found');
                return;
            }
            
            const hasVerticalScroll = messagesContainer.scrollHeight > messagesContainer.clientHeight;
            const computedStyle = getComputedStyle(messagesContainer);
            
            alert(`Scrollbar Check:
- Content scrollable: ${hasVerticalScroll ? 'Yes' : 'No'}
- Container height: ${messagesContainer.clientHeight}px
- Content height: ${messagesContainer.scrollHeight}px
- Overflow-y: ${computedStyle.overflowY}
- Scrollbar visible: ${hasVerticalScroll ? 'Should be visible' : 'Not needed'}`);
        };
        
        window.testNewButton = function() {
            const newButton = document.querySelector('.am-conversation-new-header');
            if (!newButton) {
                alert('New button not found in header');
                return;
            }
            
            alert('New button found! Click it to return to the welcome screen.');
            
            // Highlight the button
            newButton.style.background = '#fef3c7';
            setTimeout(() => {
                newButton.style.background = '';
            }, 2000);
        };
    </script>
</body>
</html>