<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Markdown Fix</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f0f0f0; }
        .test-container { background: white; padding: 20px; border-radius: 8px; margin: 20px 0; }
        button { background: #059669; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #047857; }
        .result { border: 1px solid #ccc; padding: 15px; margin: 10px 0; border-radius: 4px; background: #f8f9fa; }
        .success { border-color: #28a745; background: #d4edda; }
        .error { border-color: #dc3545; background: #f8d7da; }
    </style>
</head>
<body>
    <h1>üß™ Markdown Duplication Fix Test</h1>
    
    <div class="test-container">
        <h2>Test Markdown Processing</h2>
        <button onclick="testMarkdownFix()">Test List Processing</button>
        <button onclick="clearResults()">Clear Results</button>
        
        <div id="test-input" style="margin: 10px 0;">
            <h3>Input Text:</h3>
            <pre>I can help you analyze files such as images, PDFs, and text documents. Here's a breakdown of my capabilities:

1. **Text Extraction**: I can perform Optical Character Recognition (OCR) on images to extract text, and read text from PDFs and documents.
   
2. **Content Analysis**: I provide detailed analysis of the file contents, summarizing key information.

3. **Insights**: Based on the analysis, I can offer actionable insights related to the content.

4. **Data Categorization**: I can identify and categorize different types of data within your files.

5. **Security Compliance**: I handle your files securely, ensuring they are not stored beyond the analysis session and comply with data protection regulations.

If you have any files you'd like analyzed, please upload them now and I'll get started!</pre>
        </div>
        
        <div id="results"></div>
    </div>

    <script src="dist/index.js"></script>
    
    <script>
        function testMarkdownFix() {
            console.log('üß™ Testing markdown fix...');
            
            // Test input that was causing duplication
            const testInput = `I can help you analyze files such as images, PDFs, and text documents. Here's a breakdown of my capabilities:

1. **Text Extraction**: I can perform Optical Character Recognition (OCR) on images to extract text, and read text from PDFs and documents.
   
2. **Content Analysis**: I provide detailed analysis of the file contents, summarizing key information.

3. **Insights**: Based on the analysis, I can offer actionable insights related to the content.

4. **Data Categorization**: I can identify and categorize different types of data within your files.

5. **Security Compliance**: I handle your files securely, ensuring they are not stored beyond the analysis session and comply with data protection regulations.

If you have any files you'd like analyzed, please upload them now and I'll get started!`;

            try {
                // Access the OfflineParser directly
                const OfflineParser = window.AgentmanChatWidget.OfflineParser;
                
                if (!OfflineParser) {
                    showResult('‚ùå OfflineParser not found in bundle', 'error');
                    return;
                }

                console.log('üîç Processing with OfflineParser...');
                const result = OfflineParser.parse(testInput);
                
                console.log('üìù Processed result:', result);
                
                // Check for duplication by counting occurrences of a unique phrase
                const uniquePhrase = 'Text Extraction';
                const occurrences = (result.match(/Text Extraction/g) || []).length;
                
                console.log(`üîç Found ${occurrences} occurrences of "${uniquePhrase}"`);
                
                // Check for proper list structure
                const hasOrderedList = result.includes('<ol>');
                const hasBold = result.includes('<strong>');
                const hasListItems = result.includes('<li>');
                
                // Check that numbered items are NOT in the content (browser should handle numbering)
                const hasNumbersInContent = result.includes('<li>1.') || result.includes('<li>2.');
                
                // Count list items to ensure proper structure
                const listItemCount = (result.match(/<li>/g) || []).length;
                
                if (occurrences === 1 && !hasNumbersInContent && listItemCount === 5) {
                    showResult('‚úÖ SUCCESS: Proper list formatting!', 'success');
                    showResult('Processed HTML:', 'success', result);
                } else {
                    showResult(`‚ùå Issues found:`, 'error');
                    if (occurrences !== 1) showResult(`  - Duplication: Found ${occurrences} occurrences (should be 1)`, 'error');
                    if (hasNumbersInContent) showResult(`  - Manual numbering found in content (should let <ol> handle it)`, 'error');
                    if (listItemCount !== 5) showResult(`  - Wrong number of list items: ${listItemCount} (should be 5)`, 'error');
                    showResult('Processed HTML:', 'error', result);
                }
                
                showResult(`Detailed check:`, 'success', `
                - Ordered list: ${hasOrderedList ? '‚úÖ' : '‚ùå'}
                - Bold text: ${hasBold ? '‚úÖ' : '‚ùå'}
                - List items: ${hasListItems ? '‚úÖ' : '‚ùå'} (${listItemCount} found)
                - No manual numbers: ${!hasNumbersInContent ? '‚úÖ' : '‚ùå'}
                - No duplication: ${occurrences === 1 ? '‚úÖ' : '‚ùå'}`);
                
            } catch (error) {
                console.error('‚ùå Test failed:', error);
                showResult(`‚ùå Test failed: ${error.message}`, 'error');
            }
        }
        
        function showResult(message, type = 'result', details = '') {
            const resultsDiv = document.getElementById('results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `result ${type}`;
            resultDiv.innerHTML = `<strong>${message}</strong>`;
            
            if (details) {
                const detailsDiv = document.createElement('pre');
                detailsDiv.style.marginTop = '10px';
                detailsDiv.style.fontSize = '12px';
                detailsDiv.style.whiteSpace = 'pre-wrap';
                detailsDiv.textContent = details;
                resultDiv.appendChild(detailsDiv);
            }
            
            resultsDiv.appendChild(resultDiv);
        }
        
        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }
        
        // Initialize test when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üìÑ Markdown fix test page loaded');
            
            setTimeout(() => {
                if (window.AgentmanChatWidget) {
                    console.log('‚úÖ AgentmanChatWidget found');
                    showResult('‚úÖ Library loaded successfully - click "Test List Processing" to run test', 'success');
                } else {
                    showResult('‚ùå AgentmanChatWidget not found', 'error');
                }
            }, 100);
        });
    </script>
</body>
</html>